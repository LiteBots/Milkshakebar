zapamietaj zapamietaj ten kod <!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Milk</title>

  <meta name="theme-color" content="#FF6A00" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

  <style>
    :root{
      --primary:#FF6A00;
      --secondary:#FF9100;
      --accent:#FFE0B2;
      --bg:#FFF6EC;
      --text:#2B1300;
      --white:#fff;
      --grad:linear-gradient(135deg,var(--primary),var(--secondary));
      --radius:20px;
      --shadow:0 14px 40px rgba(0,0,0,.12);
      --shadow-soft:0 8px 22px rgba(0,0,0,.08);
      --glass:rgba(255,255,255,.82);
      --glass-strong:rgba(255,255,255,.97);
      --success:#16A34A;
      --danger:#DC2626;
      --link:#8a3d00;
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:Poppins,system-ui,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg);
      color:var(--text);
      min-height:100vh;
      -webkit-font-smoothing:antialiased;
      padding-bottom: calc(118px + var(--safe-bottom));
    }

    .blob{
      position:fixed;z-index:-1;filter:blur(70px);opacity:.33;
      width:280px;height:280px;border-radius:50%;
      background:
        radial-gradient(circle at 30% 30%, #ffe1c7, transparent 60%),
        var(--grad);
    }
    .blob.b1{top:-70px;left:-70px}
    .blob.b2{bottom:-110px;right:-90px;transform:rotate(25deg)}

    .topbar{
      position:sticky;top:0;z-index:20;
      padding: calc(10px + var(--safe-top)) 14px 10px;
      background:rgba(255,246,236,.96);
      backdrop-filter:blur(16px);
      border-bottom:1px solid rgba(0,0,0,.06);
      display:flex;align-items:center;justify-content:space-between;
    }
    .brand{
      display:flex;align-items:center;gap:10px;font-weight:900;
      font-size:1.08rem;letter-spacing:.2px;
    }
    .logo-wrap{
      width:40px;height:40px;border-radius:50%;
      background:rgba(255,255,255,.9);
      display:grid;place-items:center;
      box-shadow:var(--shadow-soft);
      border:2px solid rgba(255,255,255,.9);
      overflow:hidden;
    }
    .logo-wrap img{
      width:100%;height:100%;object-fit:cover;border-radius:50%;
    }
    .pill{
      background:var(--grad);
      color:#fff;font-weight:900;font-size:.85rem;
      padding:7px 11px;border-radius:999px;
      display:flex;gap:7px;align-items:center;
      box-shadow:0 6px 16px rgba(255,106,0,.35);
    }

    .container{padding:14px;max-width:820px;margin:0 auto;}
    .stack{display:flex;flex-direction:column;gap:12px;}
    .card{
      background:var(--glass);
      backdrop-filter:blur(14px);
      border:1px solid rgba(255,255,255,.98);
      border-radius:22px;
      box-shadow:var(--shadow);
      padding:16px;
    }
    .title{
      font-size:1.6rem;font-weight:900;
      background:var(--grad);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      margin-bottom:6px;
    }
    .subtitle{font-weight:900;margin-bottom:8px;font-size:1.05rem;}
    .muted{opacity:.82;font-size:.95rem;line-height:1.55}
    .tiny{font-size:.82rem;opacity:.7}

    label{font-size:.9rem;font-weight:900;margin:8px 0 6px;display:block}
    input,select,textarea{
      width:100%;padding:12px 14px;border-radius:14px;
      border:2px solid #eee;background:var(--white);
      font-size:1rem;outline:none;
      transition:.2s border-color,.2s box-shadow,.2s transform;
      font-family:inherit;
    }
    input:focus,select:focus,textarea:focus{
      border-color:var(--primary);
      box-shadow:0 6px 18px rgba(255,106,0,.12);
      transform:translateY(-1px);
    }
    textarea{min-height:84px;resize:vertical}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}

    .btn{
      border:none;cursor:pointer;font-weight:900;border-radius:16px;
      padding:12px 14px;display:inline-flex;align-items:center;gap:8px;
      transition:.2s transform,.2s box-shadow,.2s opacity,.2s background;
      text-decoration:none;user-select:none;-webkit-tap-highlight-color: transparent;
      justify-content:center;
    }
    .btn:active{transform:translateY(1px)}
    .btn-primary{
      background:var(--grad);color:#fff;
      box-shadow:0 8px 22px rgba(255,106,0,.5);
    }
    .btn-ghost{
      background:rgba(255,255,255,.92);
      border:1px solid rgba(0,0,0,.06);
      color:var(--text);
    }
    .btn-small{padding:8px 10px;font-size:.9rem;border-radius:12px}
    .btn-wide{width:100%;}
    .btn:disabled{opacity:.6;cursor:not-allowed}

    .tab{display:none;animation:fade .22s ease}
    .tab.active{display:block}
    @keyframes fade{
      from{opacity:0;transform:translateY(8px) scale(.99)}
      to{opacity:1;transform:none}
    }

    .points-hero{
      background:var(--grad);color:#fff;border-radius:22px;padding:16px;
      display:grid;grid-template-columns:1fr auto;gap:10px;align-items:center;
      box-shadow:var(--shadow);position:relative;overflow:hidden;
    }
    .points-hero::after{
      content:"";position:absolute;right:-40px;top:-40px;width:170px;height:170px;
      background:radial-gradient(circle, rgba(255,255,255,.45), transparent 60%);
      transform:rotate(18deg);
      pointer-events:none;
    }
    #showCodeBtn{position:relative;z-index:2;}
    .points-count{font-size:2.5rem;font-weight:900;letter-spacing:.6px;line-height:1;}
    .points-sub{display:flex;gap:8px;align-items:center;margin-top:6px;flex-wrap:wrap;}
    .chip{
      background:rgba(255,255,255,.2);
      padding:6px 10px;border-radius:999px;font-weight:900;font-size:.82rem;
      display:inline-flex;gap:6px;align-items:center;
    }
    .progress{margin-top:10px;background:rgba(255,255,255,.24);height:10px;border-radius:999px;overflow:hidden;}
    .progress > div{height:100%;background:rgba(255,255,255,.96);width:0%;transition:width .35s ease;border-radius:999px;}

    .opening-card{
      background: var(--glass);
      backdrop-filter: blur(14px);
      border: 1px solid rgba(255,255,255,.98);
      border-radius: 18px;
      box-shadow: var(--shadow-soft);
      padding: 12px 14px;
      display: grid;
      gap: 8px;
      text-align: center;
      cursor: pointer;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }
    .opening-status{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      font-weight:900;
      font-size:1.02rem;
    }
    .status-dot{
      width:10px;height:10px;border-radius:50%;
      background:#ccc;
      box-shadow: 0 0 0 3px rgba(0,0,0,.04);
    }
    .status-dot.open{ background: var(--success); }
    .status-dot.closed{ background: var(--danger); }
    .opening-hint{ font-size:.82rem; opacity:.75; font-weight:800; }
    .opening-hours{
      font-size:.9rem;
      line-height:1.55;
      opacity:.9;
      display:none;
      gap:2px;
      padding-top:6px;
      border-top:1px dashed rgba(0,0,0,.08);
    }
    .opening-card.expanded .opening-hours{ display:grid; }
    .opening-hours b{ font-weight:900; }
    .opening-hours .today{ font-weight:900; color: var(--link); }

    .quick-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:10px;}
    .quick{
      background:var(--glass-strong);border:1px solid rgba(0,0,0,.04);
      border-radius:18px;padding:12px;display:grid;gap:6px;place-items:center;text-align:center;
      box-shadow:var(--shadow-soft);
      transition:.2s transform,.2s box-shadow;
      -webkit-tap-highlight-color: transparent;
    }
    .quick:active{transform:translateY(1px)}
    .quick i{
      width:46px;height:46px;border-radius:14px;display:grid;place-items:center;
      background:var(--grad);color:#fff;box-shadow:0 6px 16px rgba(255,106,0,.45);
      font-size:1.1rem;
    }
    .quick b{font-size:.95rem;font-weight:900}
    .quick span{font-size:.8rem;opacity:.7}

    .eatmi-banner{
      margin-top:14px;
      width:100%;
      border-radius:22px;
      padding:16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      background:
        linear-gradient(135deg, rgba(255,106,0,.95), rgba(255,145,0,.95));
      color:#fff;
      box-shadow:0 14px 34px rgba(255,106,0,.45);
      text-decoration:none;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
      position:relative;
      overflow:hidden;
      transition:.25s transform,.25s box-shadow,.25s opacity;
    }
    .eatmi-banner::after{
      content:"";
      position:absolute;
      right:-60px; top:-60px;
      width:220px; height:220px;
      background:radial-gradient(circle, rgba(255,255,255,.38), transparent 65%);
      transform:rotate(18deg);
      pointer-events:none;
    }
    .eatmi-banner:hover{ box-shadow:0 18px 42px rgba(255,106,0,.55); }
    .eatmi-banner:active{ transform:translateY(1px); }

    .eatmi-left{
      display:flex;
      align-items:center;
      gap:14px;
      min-width:0;
      position:relative;
      z-index:2;
    }
    .eatmi-logo{
      width:56px;
      height:56px;
      border-radius:18px;
      background:#fff;
      display:grid;
      place-items:center;
      box-shadow:0 8px 20px rgba(0,0,0,.18);
      flex:0 0 auto;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.35);
    }
    .eatmi-logo img{
      width:74%;
      height:74%;
      object-fit:contain;
    }
    .eatmi-text{ min-width:0; }
    .eatmi-text b{
      font-size:1.12rem;
      font-weight:900;
      display:block;
      letter-spacing:.2px;
      line-height:1.1;
    }
    .eatmi-text span{
      font-size:.92rem;
      opacity:.92;
      display:block;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .eatmi-cta{
      position:relative;
      z-index:2;
      flex:0 0 auto;
      background:#fff;
      color:#ff6a00;
      font-weight:900;
      border-radius:16px;
      padding:10px 14px;
      display:flex;
      align-items:center;
      gap:8px;
      box-shadow:0 8px 18px rgba(0,0,0,.18);
      transition:.2s transform;
    }
    .eatmi-banner:hover .eatmi-cta{ transform:translateX(2px); }

    .reward{
      display:flex;gap:12px;align-items:center;justify-content:space-between;
      background:var(--glass-strong);border:1px solid rgba(0,0,0,.04);
      border-radius:18px;padding:12px;
      box-shadow:var(--shadow-soft);
    }
    .reward-left{display:flex;gap:12px;align-items:center;}
    .reward-ico{
      width:52px;height:52px;border-radius:16px;background:var(--grad);color:#fff;display:grid;place-items:center;
      box-shadow:0 6px 16px rgba(255,106,0,.45);font-size:1.25rem;
    }
    .reward-title{font-weight:900}
    .reward + .reward{margin-top:10px}

    .res-item{
      padding:10px;border-radius:14px;background:#fff;border:1px solid #eee;display:grid;gap:4px;
    }
    .res-item b{font-weight:900}
    .res-actions{display:flex;gap:8px;margin-top:6px;flex-wrap:wrap;}
    .divider{height:1px;background:rgba(0,0,0,.06);margin:4px 0 0;}

    .menu-list{display:grid;gap:10px;}
    .menu-item{
      background:var(--glass-strong);
      border:1px solid rgba(0,0,0,.05);
      border-radius:16px;
      padding:12px;
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      box-shadow:var(--shadow-soft);
    }
    .menu-left{display:flex;gap:10px;align-items:center;}
    .menu-ico{
      width:48px;height:48px;border-radius:14px;background:var(--grad);color:#fff;
      display:grid;place-items:center;font-size:1.2rem;box-shadow:0 6px 14px rgba(255,106,0,.4);
    }
    .menu-title{font-weight:900}
    .menu-desc{font-size:.85rem;opacity:.7}
    .menu-price{font-weight:900}
    .cart-line{
      display:flex;align-items:center;justify-content:space-between;gap:8px;
      background:#fff;border:1px solid #eee;border-radius:12px;padding:8px 10px;
    }
    .cart-actions{display:flex;gap:6px;align-items:center;}
    .qty-btn{
      width:28px;height:28px;border-radius:8px;border:none;cursor:pointer;font-weight:900;
      background:rgba(0,0,0,.06);
    }

    .account-hero{display:flex;gap:12px;align-items:center;}
    .avatar{
      width:56px;height:56px;border-radius:16px;background:var(--grad);display:grid;place-items:center;
      color:#fff;font-size:1.3rem;font-weight:900;box-shadow:0 8px 20px rgba(255,106,0,.5);
    }
    .account-name{font-weight:900;font-size:1.1rem}
    .account-mail{font-size:.9rem;opacity:.75}
    .list{display:flex;flex-direction:column;gap:8px;}
    .list-item{
      background:var(--glass-strong);border:1px solid rgba(0,0,0,.04);
      padding:12px;border-radius:16px;display:flex;align-items:center;justify-content:space-between;
      box-shadow:var(--shadow-soft);
      cursor:pointer;transition:.2s transform,.2s box-shadow;-webkit-tap-highlight-color: transparent;
    }
    .list-item:active{transform:translateY(1px)}
    .list-left{display:flex;gap:10px;align-items:center;}
    .li-ico{
      width:40px;height:40px;border-radius:12px;background:rgba(0,0,0,.05);
      display:grid;place-items:center;font-size:1.05rem;
    }
    .li-title{font-weight:900}
    .li-sub{font-size:.85rem;opacity:.7}

    .auth-wrap{display:grid;gap:10px;}
    .auth-btn{width:100%;justify-content:center;font-weight:900;}
    .auth-btn.google{background:#fff;border:2px solid #eee;}
    .auth-sep{display:flex;align-items:center;gap:10px;margin:6px 0;}
    .auth-sep::before,.auth-sep::after{content:"";flex:1;height:1px;background:rgba(0,0,0,.08);}
    .auth-sep span{font-size:.85rem;opacity:.7;font-weight:800;}

    .subpage{
      position:fixed;inset:0;background:var(--bg);z-index:80;display:none;flex-direction:column;
      animation:slideIn .25s ease;padding-bottom: calc(20px + var(--safe-bottom));
    }
    .subpage.active{display:flex;}
    @keyframes slideIn{from{opacity:0;transform:translateX(8px)}to{opacity:1;transform:none}}
    .sub-top{
      position:sticky;top:0;z-index:5;
      padding: calc(10px + var(--safe-top)) 14px 10px;
      background:rgba(255,246,236,.96);backdrop-filter:blur(12px);
      border-bottom:1px solid rgba(0,0,0,.06);
      display:flex;align-items:center;gap:10px;
    }
    .back-btn{
      width:40px;height:40px;border-radius:12px;border:none;background:#fff;cursor:pointer;
      display:grid;place-items:center;box-shadow:0 4px 12px rgba(0,0,0,.08);
    }
    .sub-title{font-weight:900;font-size:1.05rem}

    .empty{
      background:var(--glass-strong);padding:14px;border-radius:16px;border:1px dashed rgba(0,0,0,.07);
      display:flex;gap:12px;align-items:center;
    }
    .empty .icon{
      width:48px;height:48px;border-radius:14px;background:var(--grad);color:#fff;display:grid;place-items:center;font-size:1.2rem;
      box-shadow:0 6px 14px rgba(255,106,0,.4);
    }

    .bottom-nav{
      position:fixed;
      left:0; right:0;
      bottom:10px;
      z-index:50;
      display:flex;
      justify-content:center;
      pointer-events:none;
    }
    .nav-wrap{
      pointer-events:auto;
      width:min(820px,calc(100% - 18px));
      background:rgba(255,255,255,.88);
      backdrop-filter:blur(16px);
      border:1px solid rgba(255,255,255,.98);
      box-shadow:0 10px 28px rgba(0,0,0,.18);
      border-radius:999px;
      padding:6px 6px;
      display:flex;
      gap:6px;
      align-items:stretch;
    }
    .nav-btn{
      flex:1 1 0;
      min-width:0;
      background:transparent;
      border:none;
      cursor:pointer;
      border-radius:999px;
      padding:8px 4px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:4px;
      font-weight:900;
      color:var(--text);
      opacity:.7;
      transition:.2s all;
      -webkit-tap-highlight-color: transparent;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .nav-btn i{font-size:clamp(.95rem, 2.8vw, 1.12rem);line-height:1;}
    .nav-btn .lbl{font-size:clamp(.62rem, 2.2vw, .73rem);line-height:1.05;text-align:center;}
    .nav-btn.active{
      background:var(--grad);
      color:#fff;
      opacity:1;
      transform:translateY(-2px);
      box-shadow:0 8px 18px rgba(255,106,0,.45);
    }
    @media (max-width:560px){
      .row{grid-template-columns:1fr}
      .quick-grid{grid-template-columns:1fr 1fr 1fr}
    }
    @media (max-width:420px){ .eatmi-text span{display:none;} }
    @media (max-width:380px){ .quick-grid{grid-template-columns:1fr 1fr} }

    .toast{
      position:fixed;left:50%;bottom: calc(126px + var(--safe-bottom));
      transform:translateX(-50%) translateY(8px);
      background:var(--success);color:#fff;font-weight:900;font-size:.95rem;
      padding:10px 14px;border-radius:999px;box-shadow:0 10px 25px rgba(0,0,0,.25);
      opacity:0;pointer-events:none;transition:.25s;z-index:999;display:flex;gap:8px;align-items:center;
    }
    .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
    .toast.danger{background:var(--danger)}

    .modal{position:fixed; inset:0; z-index:100; display:none;}
    .modal.show{display:block;}
    .modal-backdrop{
      position:absolute; inset:0;
      background:rgba(0,0,0,.35);
      backdrop-filter: blur(2px);
      animation:fadeBg .18s ease;
    }
    @keyframes fadeBg{from{opacity:0}to{opacity:1}}
    .modal-sheet{
      position:absolute; left:0; right:0; bottom:0;
      background: var(--glass-strong);
      border-radius: 22px 22px 0 0;
      box-shadow: 0 -12px 40px rgba(0,0,0,.25);
      padding: 10px 14px 18px;
      transform: translateY(12px);
      animation:sheetUp .22s ease forwards;
    }
    @keyframes sheetUp{to{transform:translateY(0)}}
    .modal-handle{
      width:46px; height:5px; border-radius:999px;
      background:rgba(0,0,0,.12); margin:6px auto 10px;
    }
    .modal-header{
      display:flex; align-items:center; justify-content:space-between;
      margin-bottom:10px;
    }
    .modal-title{
      font-weight:900; font-size:1.2rem;
      background:var(--grad);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
    }
    .modal-close{
      width:40px; height:40px; border-radius:12px; border:none; cursor:pointer;
      background:#fff; display:grid; place-items:center;
      box-shadow: var(--shadow-soft);
    }
    .modal-code-box{
      background:#0f0f0f; color:#fff;
      border-radius:18px; padding:18px 14px;
      box-shadow: inset 0 0 0 2px rgba(255,255,255,.06);
    }
    .modal-code{
      font-size:2.4rem; font-weight:900;
      letter-spacing:10px; text-align:center;
      font-variant-numeric: tabular-nums;
    }
    .modal-actions{ margin-top:10px; display:grid; gap:8px; }

    .install-guide{
      position:fixed; inset:0; z-index:200;
      display:none;
      padding: calc(14px + var(--safe-top)) 14px calc(14px + var(--safe-bottom));
      overflow:auto;
      background:
        radial-gradient(900px 600px at 10% 10%, rgba(255,106,0,.12), transparent 60%),
        radial-gradient(900px 600px at 90% 90%, rgba(255,145,0,.14), transparent 60%),
        linear-gradient(180deg, rgba(255,246,236,.98), rgba(255,246,236,.985));
    }
    .install-guide.show{ display:block; }
    .install-shell{ max-width: 860px; margin: 0 auto; display:grid; gap:12px; }
    .install-hero{
      background: rgba(255,255,255,.86);
      border: 1px solid rgba(255,255,255,.98);
      border-radius: 26px;
      box-shadow: var(--shadow);
      padding: 16px;
      overflow:hidden;
      position:relative;
    }
    .install-hero::after{
      content:"";
      position:absolute;
      right:-70px; top:-70px;
      width:260px; height:260px;
      background: radial-gradient(circle, rgba(255,106,0,.22), transparent 65%);
      transform: rotate(18deg);
      pointer-events:none;
    }
    .install-top{display:flex;align-items:flex-start;justify-content:space-between;gap:12px;}
    .install-brand{display:flex;gap:12px;align-items:center;min-width:0;}
    .install-badge{
      width:54px;height:54px;border-radius:18px;
      background: var(--grad);
      color:#fff;
      display:grid;
      place-items:center;
      box-shadow: 0 12px 26px rgba(255,106,0,.35);
      font-size:1.25rem;
      flex:0 0 auto;
    }
    .install-headline{min-width:0;}
    .install-kicker{ font-weight:900; opacity:.72; font-size:.9rem; }
    .install-title{
      font-size:1.35rem;
      font-weight:900;
      margin-top:2px;
      line-height:1.15;
      background:var(--grad);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
    }
    .install-sub{
      margin-top:6px;
      opacity:.86;
      line-height:1.45;
      font-weight:700;
      max-width: 58ch;
    }
    .platform-switch{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:8px;
      margin-top:12px;
    }
    .platform-btn{
      border:none; cursor:pointer;
      padding:12px 10px;
      border-radius:18px;
      background: rgba(255,255,255,.92);
      border:1px solid rgba(0,0,0,.06);
      font-weight:900;
      display:flex; align-items:center; justify-content:center; gap:10px;
      -webkit-tap-highlight-color: transparent;
      transition:.2s transform,.2s box-shadow,.2s opacity,.2s background;
      color: var(--text);
      opacity:.88;
    }
    .platform-btn i{
      width:34px;height:34px;border-radius:12px;
      display:grid;place-items:center;
      background: rgba(0,0,0,.05);
      font-size:1.05rem;
    }
    .platform-btn.active{
      background: var(--grad);
      color:#fff;
      opacity:1;
      box-shadow:0 10px 22px rgba(255,106,0,.32);
      transform: translateY(-1px);
    }
    .platform-btn.active i{ background: rgba(255,255,255,.22); color:#fff; }

    .install-panel{
      background: rgba(255,255,255,.84);
      border: 1px solid rgba(255,255,255,.98);
      border-radius: 26px;
      box-shadow: var(--shadow);
      padding: 16px;
    }
    .install-pane{ display:none; }
    .install-pane.active{ display:block; }
    .steps{ display:grid; gap:10px; margin-top:10px; }
    .step{
      display:flex;
      gap:12px;
      align-items:flex-start;
      padding:12px;
      border-radius:18px;
      background: rgba(255,255,255,.92);
      border: 1px solid rgba(0,0,0,.05);
      box-shadow: var(--shadow-soft);
    }
    .step-num{
      width:36px;height:36px;border-radius:14px;
      background: var(--grad);
      color:#fff;
      display:grid;place-items:center;
      font-weight:900;
      flex:0 0 auto;
      box-shadow:0 8px 18px rgba(255,106,0,.28);
    }
    .step-body b{ font-weight:900; }
    .step-body{ line-height:1.45; font-weight:750; opacity:.92; }
    .install-ctaRow{ display:grid; gap:8px; margin-top:12px; }
    .install-note{
      margin-top:10px;
      font-size:.86rem;
      opacity:.82;
      line-height:1.45;
      font-weight:700;
      padding:12px;
      border-radius:18px;
      background: rgba(255,255,255,.9);
      border:1px dashed rgba(0,0,0,.10);
    }
    .install-note i{ color: var(--primary); }
    .install-helpRow{ margin-top:12px; display:grid; gap:8px; }
    .help-pill{
      background: rgba(255,255,255,.9);
      border:1px solid rgba(0,0,0,.06);
      border-radius:18px;
      padding:12px;
      box-shadow: var(--shadow-soft);
      display:flex;
      align-items:flex-start;
      gap:10px;
      font-weight:750;
      opacity:.92;
      line-height:1.45;
    }
    .help-pill .hico{
      width:40px;height:40px;border-radius:14px;
      background: rgba(0,0,0,.05);
      display:grid;place-items:center;
      flex:0 0 auto;
    }
    .help-pill b{ font-weight:900; }

    @media (max-width:520px){
      .platform-switch{ grid-template-columns:1fr; }
    }

    /* =========================
       ‚úÖ NOWE: Kategorie + FAB
       ========================= */
    .categories-bar{
      display:flex;
      gap:8px;
      overflow:auto;
      padding:4px 2px 10px;
      -webkit-overflow-scrolling:touch;
      scroll-snap-type:x mandatory;
    }
    .cat-chip{
      flex:0 0 auto;
      scroll-snap-align:start;
      border:none;
      cursor:pointer;
      border-radius:999px;
      padding:10px 12px;
      font-weight:900;
      background:rgba(255,255,255,.92);
      border:1px solid rgba(0,0,0,.06);
      box-shadow:var(--shadow-soft);
      opacity:.9;
      transition:.2s transform,.2s box-shadow,.2s opacity,.2s background;
      white-space:nowrap;
      -webkit-tap-highlight-color: transparent;
    }
    .cat-chip:active{transform:translateY(1px)}
    .cat-chip.active{
      background:var(--grad);
      color:#fff;
      opacity:1;
      box-shadow:0 10px 22px rgba(255,106,0,.35);
    }

    .order-fab{
      position:fixed;
      left:50%;
      transform:translateX(-50%);
      bottom: calc(86px + var(--safe-bottom)); /* nad dolnym nav */
      width:min(820px, calc(100% - 18px));
      border:none;
      cursor:pointer;
      border-radius:999px;
      padding:12px 14px;
      background:var(--grad);
      color:#fff;
      font-weight:900;
      box-shadow:0 16px 34px rgba(255,106,0,.45);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      z-index:60;
      -webkit-tap-highlight-color: transparent;
    }
    .order-fab:active{transform:translateX(-50%) translateY(1px)}
    .fab-left{display:flex;align-items:center;gap:10px;}
    .fab-right{opacity:.95;}
  </style>
</head>

<body>
  <div class="blob b1"></div>
  <div class="blob b2"></div>

  <!-- INSTALL GUIDE -->
  <section id="installGuide" class="install-guide" aria-hidden="true">
    <div class="install-shell">

      <div class="install-hero">
        <div class="install-top">
          <div class="install-brand">
            <div class="install-badge"><i class="fa-solid fa-mobile-screen-button"></i></div>
            <div class="install-headline">
              <div class="install-kicker">Milk ‚Ä¢ uruchom jak aplikacjƒô</div>
              <div class="install-title">Dodaj Milk do ekranu g≈Ç√≥wnego</div>
              <div class="install-sub">
                To zajmie <b>oko≈Ço 10 sekund</b>. Potem otwierasz Milk z ikony ‚Äî szybciej i wygodniej.
              </div>
            </div>
          </div>
        </div>

        <div class="platform-switch" style="position:relative;z-index:2;">
          <button class="platform-btn active" data-guide-tab="android">
            <i class="fa-brands fa-android"></i> Android (Chrome)
          </button>
          <button class="platform-btn" data-guide-tab="ios">
            <i class="fa-brands fa-apple"></i> iPhone / iPad (Safari)
          </button>
        </div>
      </div>

      <div class="install-panel">
        <div class="install-pane active" data-guide-pane="android">
          <div class="subtitle" style="margin:0;">Android ‚Äî instalacja</div>
          <div class="tiny" style="margin-top:4px; opacity:.78;">
            Najczƒô≈õciej dzia≈Ça w <b>Chrome</b>. Je≈õli widzisz przycisk ‚ÄûZainstaluj‚Äù, kliknij go.
          </div>

          <div class="install-ctaRow">
            <button id="androidInstallBtn" class="btn btn-primary btn-wide" style="display:none;">
              Zainstaluj teraz <i class="fa-solid fa-download"></i>
            </button>
            <div class="tiny" id="androidInstallHint" style="opacity:.78; text-align:center;">
              Je≈õli nie widzisz przycisku ‚Äî zr√≥b to rƒôcznie poni≈ºej.
            </div>
          </div>

          <div class="steps">
            <div class="step"><div class="step-num">1</div><div class="step-body">Naci≈õnij menu przeglƒÖdarki: <b>‚ãÆ</b> (prawy g√≥rny r√≥g).</div></div>
            <div class="step"><div class="step-num">2</div><div class="step-body">Wybierz <b>‚ÄûZainstaluj aplikacjƒô‚Äù</b> lub <b>‚ÄûDodaj do ekranu g≈Ç√≥wnego‚Äù</b>.</div></div>
            <div class="step"><div class="step-num">3</div><div class="step-body">Potwierd≈∫: <b>Zainstaluj / Dodaj</b>. Gotowe ‚úÖ</div></div>
          </div>

          <div class="install-helpRow">
            <div class="help-pill">
              <div class="hico"><i class="fa-solid fa-circle-question"></i></div>
              <div>
                <b>Nie widzƒô tej opcji?</b><br>
                Upewnij siƒô, ≈ºe masz otwarte w <b>Chrome</b> i od≈õwie≈º stronƒô.
              </div>
            </div>
          </div>

          <div class="install-note">
            <i class="fa-solid fa-shield-heart"></i>
            Poradnik zniknie automatycznie, gdy uruchomisz Milk z ikony (tryb aplikacji).
            <div class="tiny" style="margin-top:6px; opacity:.78;">
              Problem? Napisz: <b>support@velorie.pl</b>
            </div>
          </div>
        </div>

        <div class="install-pane" data-guide-pane="ios">
          <div class="subtitle" style="margin:0;">iPhone / iPad ‚Äî instalacja</div>
          <div class="tiny" style="margin-top:4px; opacity:.78;">
            Wa≈ºne: na iOS dodawanie dzia≈Ça w <b>Safari</b> (nie w Chrome).
          </div>

          <div class="steps">
            <div class="step"><div class="step-num">1</div><div class="step-body">Otw√≥rz tƒô stronƒô w <b>Safari</b>.</div></div>
            <div class="step"><div class="step-num">2</div><div class="step-body">Kliknij <b>Udostƒôpnij</b> (ikonka <b>‚¨ÜÔ∏è</b> na dole ekranu).</div></div>
            <div class="step"><div class="step-num">3</div><div class="step-body">Wybierz <b>‚ÄûDodaj do ekranu poczƒÖtkowego‚Äù</b>, potem <b>Dodaj</b>. Gotowe ‚úÖ</div></div>
          </div>

          <div class="install-helpRow">
            <div class="help-pill">
              <div class="hico"><i class="fa-solid fa-lightbulb"></i></div>
              <div>
                <b>Nie ma ‚ÄûDodaj do ekranu‚Äù?</b><br>
                Przewi≈Ñ listƒô w d√≥≈Ç w panelu udostƒôpniania. Je≈õli dalej brak ‚Äî upewnij siƒô, ≈ºe to <b>Safari</b>.
              </div>
            </div>
          </div>

          <div class="install-note">
            <i class="fa-solid fa-shield-heart"></i>
            Poradnik zniknie automatycznie, gdy uruchomisz Milk z ikony (tryb aplikacji).
            <div class="tiny" style="margin-top:6px; opacity:.78;">
              Problem? Napisz: <b>support@velorie.pl</b>
            </div>
          </div>
        </div>
      </div>

    </div>
  </section>

  <!-- TOPBAR -->
  <div class="topbar">
    <div class="brand">
      <div class="logo-wrap">
        <img src="https://i.imgur.com/UNPIPSC.png" alt="Milk logo">
      </div>
      Milk
    </div>
    <div class="pill"><i class="fa-solid fa-star"></i> <span id="pointsPill">Zaloguj siƒô</span></div>
  </div>

  <main class="container">

    <!-- TAB: PUNKTY -->
    <section id="tab-points" class="tab active">

      <div class="opening-card" id="openingCard" title="Kliknij, aby zobaczyƒá godziny otwarcia">
        <div class="opening-status">
          <span class="status-dot" id="openDot"></span>
          <span id="openText">Sprawdzam status...</span>
        </div>
        <div class="opening-hint" id="openHint">Kliknij, aby zobaczyƒá godziny otwarcia</div>
        <div class="opening-hours" id="openingHours"></div>
      </div>

      <div class="points-hero">
        <div>
          <div class="tiny">Twoje punkty</div>
          <div class="points-count" id="pointsCount">‚Äî</div>
          <div class="points-sub">
            <div class="chip"><i class="fa-solid fa-receipt"></i> 10 z≈Ç = 1 pkt</div>
          </div>
        </div>

        <button class="btn btn-ghost btn-small" id="showCodeBtn">
          <i class="fa-solid fa-id-card"></i> Milk ID
        </button>
      </div>

      <div class="progress"><div id="pointsProgress"></div></div>

      <div class="card">
        <div class="subtitle">Szybkie akcje</div>
        <div class="quick-grid">
          <button class="quick" data-go="rewards">
            <i class="fa-solid fa-gift"></i>
            <b>Nagrody</b>
            <span>Wymie≈Ñ punkty</span>
          </button>

          <button class="quick" data-go="order">
            <i class="fa-solid fa-bag-shopping"></i>
            <b>Zam√≥w i odbierz</b>
            <span>P≈Çatno≈õƒá na miejscu</span>
          </button>

          <button class="quick" data-go="res">
            <i class="fa-solid fa-calendar-check"></i>
            <b>Rezerwuj</b>
            <span>Stolik w 10s</span>
          </button>
        </div>

        <a class="eatmi-banner" href="https://www.eatmi.pl" target="_blank" rel="noopener">
          <div class="eatmi-left">
            <div class="eatmi-logo">
              <img src="https://i.imgur.com/XrTPEHC.png" alt="Eatmi logo">
            </div>
            <div class="eatmi-text">
              <b>Eatmi</b>
              <span>Zamawiaj online szybciej i wygodniej</span>
            </div>
          </div>
          <div class="eatmi-cta">
            Przejd≈∫ <i class="fa-solid fa-arrow-up-right-from-square"></i>
          </div>
        </a>
      </div>

      <div class="card">
        <div class="subtitle">Historia punkt√≥w</div>
        <div id="pointsHistory" class="muted"></div>
      </div>
    </section>

    <!-- TAB: NAGRODY -->
    <section id="tab-rewards" class="tab">
      <div class="card">
        <div class="title">Nagrody</div>
        <p class="muted">Kliknij ‚ÄûWymie≈Ñ‚Äù, a poka≈ºemy Ci kod do odbioru w lokalu.</p>
      </div>
      <div class="card" id="rewardsList"></div>
    </section>

    <!-- TAB: ZAM√ìW I ODBIERZ -->
    <section id="tab-order" class="tab">
      <div class="card">
        <div class="title">Zam√≥w i odbierz</div>
        <p class="muted">
          Z≈Ç√≥≈º zam√≥wienie w aplikacji, odbierz w lokalu. <b>P≈Çatno≈õƒá na miejscu</b> (got√≥wka/karta).
        </p>
      </div>

      <div class="card">
        <div class="subtitle">Menu</div>
        <div class="tiny" id="menuHint" style="opacity:.78;margin:-4px 0 10px">
          ≈Åadujƒô menu‚Ä¶
        </div>

        <!-- ‚úÖ NOWE: Tylko kategorie, dopiero po klikniƒôciu produkty -->
        <div id="categoriesBar" class="categories-bar"></div>
        <div id="menuList" class="menu-list"></div>
      </div>

      <div class="card stack">
        <div class="subtitle">Koszyk</div>
        <div id="cartList" class="stack"></div>
        <div class="divider"></div>
        <div style="display:flex;justify-content:space-between;font-weight:900;font-size:1.05rem">
          <span>Razem</span><span id="cartTotal">0 z≈Ç</span>
        </div>

        <!-- ‚úÖ WYMAGANE: imiƒô i nazwisko + telefon -->
        <div class="row" style="margin-top:10px">
          <div>
            <label>Imiƒô i nazwisko (wymagane)</label>
            <input type="text" id="orderCustomerName" placeholder="Jan Kowalski" required>
          </div>
          <div>
            <label>Telefon (wymagane)</label>
            <input type="tel" id="orderCustomerPhone" placeholder="+48 700 000 000" required>
          </div>
        </div>

        <div class="row" style="margin-top:6px">
          <div>
            <label>Godzina odbioru</label>
            <input type="time" id="pickupTime" required step="900">
            <div class="tiny" id="pickupRuleHint" style="margin-top:6px;opacity:.78;text-align:center"></div>
          </div>
          <div>
            <label>Lokal</label>
            <select id="pickupLocation">
              <option>S≈Çupsk</option>
              <option value="Rowy" disabled>Rowy (chwilowo niedostƒôpna)</option>
            </select>
            <div class="tiny" style="margin-top:6px;opacity:.78;text-align:center">
              Rowy jest chwilowo niedostƒôpne.
            </div>
          </div>
        </div>

        <div>
          <label>Uwagi (opcjonalnie)</label>
          <textarea id="orderNotes" placeholder="np. bez bitej ≈õmietany, alergie, itp."></textarea>
        </div>

        <button class="btn btn-primary btn-wide" id="submitOrderBtn">
          Z≈Ç√≥≈º zam√≥wienie <i class="fa-solid fa-check"></i>
        </button>
        <div class="tiny" style="text-align:center">
          P≈Çatno≈õƒá na miejscu przy odbiorze.
        </div>
      </div>

      <div class="card">
        <div class="subtitle">Twoje zam√≥wienia</div>
        <div id="ordersList" class="muted"></div>
      </div>

      <!-- ‚úÖ NOWE: P≈ÇywajƒÖcy przycisk podsumowania -->
      <button id="orderSummaryFab" class="order-fab" style="display:none;">
        <span class="fab-left">
          <i class="fa-solid fa-receipt"></i>
          <b>Podsumowanie</b>
        </span>
        <span class="fab-right">
          <span id="fabItems">0</span> ‚Ä¢ <span id="fabTotal">0 z≈Ç</span>
        </span>
      </button>
    </section>

    <!-- TAB: REZERWACJE -->
    <section id="tab-res" class="tab">
      <div class="card">
        <div class="title">Rezerwacje</div>
        <p class="muted">Zarezerwuj stolik w kilka sekund. Potwierdzenie dostaniesz SMS lub telefonicznie.</p>
      </div>

      <div class="card">
        <div class="subtitle">Formularz rezerwacji</div>
        <form id="reservationForm" class="stack">
          <div>
            <label>Imiƒô i nazwisko</label>
            <input name="name" required placeholder="Jan Kowalski">
          </div>

          <div>
            <label>Telefon</label>
            <input name="phone" required placeholder="+48 700 000 000">
          </div>

          <div class="row">
            <div>
              <label>Data</label>
              <input type="date" name="date" required>
            </div>
            <div>
              <label>Godzina</label>
              <input type="time" name="time" required>
            </div>
          </div>

          <div class="row">
            <div>
              <label>Ilo≈õƒá os√≥b</label>
              <select name="guests" required>
                <option value="1">1 osoba</option>
                <option value="2" selected>2 osoby</option>
                <option value="3">3 osoby</option>
                <option value="4">4 osoby</option>
                <option value="5+">5+ os√≥b</option>
              </select>
            </div>
            <div>
              <label>Strefa</label>
              <select name="room" required>
                <option>Sala frontowa</option>
                <option>Sala g≈Ç√≥wna</option>
                <option>KƒÖcik dla dzieci</option>
              </select>
            </div>
          </div>

          <div>
            <label>Uwagi (opcjonalnie)</label>
            <textarea name="notes" placeholder="np. urodziny, alergie"></textarea>
          </div>

          <button class="btn btn-primary btn-wide">
            Zarezerwuj <i class="fa-solid fa-check"></i>
          </button>
        </form>
      </div>

      <div class="card">
        <div class="subtitle">Twoje rezerwacje</div>
        <div id="reservationsList" class="muted"></div>
      </div>
    </section>

    <!-- TAB: KONTO -->
    <section id="tab-account" class="tab">
      <div id="accountLoggedOut" class="stack">
        <div class="card">
          <div class="title">Konto</div>
          <p class="muted">Zaloguj siƒô, aby synchronizowaƒá punkty, nagrody i rezerwacje na wszystkich urzƒÖdzeniach.</p>
        </div>

        <div class="card auth-wrap">
          <div class="subtitle">Zaloguj siƒô</div>

          <button class="btn auth-btn google" id="loginGoogle">
            <i class="fa-brands fa-google"></i> Kontynuuj z Google
          </button>

          <div class="auth-sep"><span>lub</span></div>

          <form id="loginEmailForm" class="stack">
            <div>
              <label>Email</label>
              <input type="email" name="email" placeholder="np. klient@mail.com" required>
            </div>
            <div>
              <label>Has≈Ço (opcjonalnie)</label>
              <input type="password" name="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>
            <button class="btn btn-primary btn-wide">
              Zaloguj siƒô <i class="fa-solid fa-right-to-bracket"></i>
            </button>
            <div class="tiny" style="text-align:center;opacity:.75">
              Je≈õli nie u≈ºywasz hase≈Ç ‚Äî wpisz sam email (backend mo≈ºe tworzyƒá konto automatycznie).
            </div>
          </form>
        </div>
      </div>

      <div id="accountLoggedIn" class="stack" style="display:none">
        <div class="card account-hero">
          <div class="avatar" id="avatar">MK</div>
          <div>
            <div class="account-name" id="accName">U≈ºytkownik</div>
            <div class="account-mail" id="accEmail">user@mail.com</div>
            <div class="tiny" style="margin-top:2px">Zalogowano</div>
          </div>
          <div style="margin-left:auto">
            <button class="btn btn-ghost btn-small" id="logoutBtn">Wyloguj</button>
          </div>
        </div>

        <div class="card">
          <div class="subtitle">Ustawienia</div>
          <div class="list">
            <div class="list-item" data-open="personal">
              <div class="list-left">
                <div class="li-ico"><i class="fa-solid fa-user"></i></div>
                <div>
                  <div class="li-title">Dane osobowe</div>
                  <div class="li-sub">Imiƒô, telefon, email</div>
                </div>
              </div>
              <i class="fa-solid fa-chevron-right" style="opacity:.6"></i>
            </div>

            <div class="list-item" data-open="language">
              <div class="list-left">
                <div class="li-ico"><i class="fa-solid fa-language"></i></div>
                <div>
                  <div class="li-title">Jƒôzyk</div>
                  <div class="li-sub">Polski / English</div>
                </div>
              </div>
              <i class="fa-solid fa-chevron-right" style="opacity:.6"></i>
            </div>

            <div class="list-item" data-open="about">
              <div class="list-left">
                <div class="li-ico"><i class="fa-solid fa-circle-info"></i></div>
                <div>
                  <div class="li-title">O nas</div>
                  <div class="li-sub">MilkShake Bar S≈Çupsk & Rowy</div>
                </div>
              </div>
              <i class="fa-solid fa-chevron-right" style="opacity:.6"></i>
            </div>

            <div class="list-item" data-open="help">
              <div class="list-left">
                <div class="li-ico"><i class="fa-solid fa-life-ring"></i></div>
                <div>
                  <div class="li-title">Pomoc</div>
                  <div class="li-sub">Kontakt i informacje</div>
                </div>
              </div>
              <i class="fa-solid fa-chevron-right" style="opacity:.6"></i>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="subtitle">Synchronizacja</div>
          <button class="btn btn-primary btn-wide" id="syncBtn">
            Od≈õwie≈º dane z serwera <i class="fa-solid fa-rotate"></i>
          </button>
          <div class="tiny" style="text-align:center;opacity:.78;margin-top:8px">
            Pobiera: punkty, historiƒô, nagrody, zam√≥wienia, rezerwacje (je≈õli endpointy istniejƒÖ).
          </div>
        </div>
      </div>
    </section>

  </main>

  <!-- SUBPAGES -->
  <section class="subpage" id="page-personal">
    <div class="sub-top">
      <button class="back-btn" data-back><i class="fa-solid fa-arrow-left"></i></button>
      <div class="sub-title">Dane osobowe</div>
    </div>
    <div class="container stack">
      <div class="card stack">
        <div>
          <label>Imiƒô i nazwisko</label>
          <input id="personalName" placeholder="Jan Kowalski">
        </div>
        <div>
          <label>Telefon</label>
          <input id="personalPhone" placeholder="+48 700 000 000">
        </div>
        <div>
          <label>Email</label>
          <input id="personalEmail" placeholder="mail@adres.com">
        </div>
        <button class="btn btn-primary btn-wide" id="savePersonalBtn">Zapisz zmiany</button>
      </div>
    </div>
  </section>

  <section class="subpage" id="page-language">
    <div class="sub-top">
      <button class="back-btn" data-back><i class="fa-solid fa-arrow-left"></i></button>
      <div class="sub-title">Jƒôzyk</div>
    </div>
    <div class="container stack">
      <div class="card stack">
        <button class="btn btn-ghost btn-wide" data-lang="pl">üáµüá± Polski</button>
        <button class="btn btn-ghost btn-wide" data-lang="en">üá¨üáß English</button>
      </div>
    </div>
  </section>

  <section class="subpage" id="page-about">
    <div class="sub-top">
      <button class="back-btn" data-back><i class="fa-solid fa-arrow-left"></i></button>
      <div class="sub-title">O nas</div>
    </div>
    <div class="container stack">
      <div class="card">
        <div class="subtitle">MilkShake Bar</div>
        <p class="muted">
          Kremowe milkshake‚Äôi, desery i burgery w S≈Çupsku oraz Rowach.
          Tworzymy miejsce pe≈Çne energii i s≈Çodkich wspomnie≈Ñ.
        </p>
      </div>
    </div>
  </section>

  <section class="subpage" id="page-help">
    <div class="sub-top">
      <button class="back-btn" data-back><i class="fa-solid fa-arrow-left"></i></button>
      <div class="sub-title">Pomoc</div>
    </div>
    <div class="container stack">
      <div class="card stack">
        <div class="subtitle">Developer aplikacji</div>
        <p class="muted">Aplikacja zosta≈Ça wykonana przez <b>Velorie Design</b>.</p>
        <a class="btn btn-primary btn-wide" href="https://www.desing.velorie.pl" target="_blank" rel="noopener">
          www.desing.velorie.pl <i class="fa-solid fa-arrow-up-right-from-square"></i>
        </a>
      </div>
    </div>
  </section>

  <!-- Bottom nav -->
  <nav class="bottom-nav" aria-label="Dolne menu">
    <div class="nav-wrap">
      <button class="nav-btn active" data-tab="points">
        <i class="fa-solid fa-star"></i><div class="lbl">Punkty</div>
      </button>
      <button class="nav-btn" data-tab="rewards">
        <i class="fa-solid fa-gift"></i><div class="lbl">Nagrody</div>
      </button>
      <button class="nav-btn" data-tab="order">
        <i class="fa-solid fa-bag-shopping"></i><div class="lbl">Zam√≥w</div>
      </button>
      <button class="nav-btn" data-tab="res">
        <i class="fa-solid fa-calendar-check"></i><div class="lbl">Rezerwuj</div>
      </button>
      <button class="nav-btn" data-tab="account">
        <i class="fa-solid fa-user"></i><div class="lbl">Konto</div>
      </button>
    </div>
  </nav>

  <!-- Toast -->
  <div id="toast" class="toast">
    <i class="fa-solid fa-check-circle"></i><span id="toastText"></span>
  </div>

  <!-- MODAL: KOD LOJALNO≈öCIOWY -->
  <div id="codeModal" class="modal">
    <div class="modal-backdrop" data-close></div>

    <div class="modal-sheet" role="dialog" aria-modal="true" aria-labelledby="codeTitle">
      <div class="modal-handle"></div>

      <div class="modal-header">
        <div>
          <div class="tiny">Tw√≥j kod lojalno≈õciowy</div>
          <div id="codeTitle" class="modal-title">Milk ID</div>
        </div>
        <button class="modal-close" data-close aria-label="Zamknij">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>

      <div class="modal-code-box">
        <div class="modal-code" id="loyaltyCode">000000</div>
        <div class="tiny" style="opacity:.9;text-align:center;margin-top:6px;">
          Poka≈º obs≈Çudze przy kasie
        </div>
      </div>

      <div class="modal-actions">
        <button class="btn btn-ghost btn-wide" id="copyCodeBtn">
          <i class="fa-solid fa-copy"></i> Kopiuj kod
        </button>
      </div>

      <p class="tiny" style="text-align:center;margin-top:8px;">
        Kod jest sta≈Çy i zawsze przypisany do Twojego konta.
      </p>
    </div>
  </div>

<script>
<script>
/* =========================
   MILK PWA ‚Äî SCRIPT (CZƒò≈öƒÜ 2)
   Zmiany:
   ‚úÖ Menu wbudowane w kod (bez menu.json)
   ‚úÖ Nowe nagrody (3 pozycje) + usuniƒôte stare
   ‚úÖ Usuniƒôta funkcja/przycisk ‚Äúod≈õwie≈º dane z serwera‚Äù (nie ma go w HTML, i nie ma logiki w JS)
   ========================= */

(() => {
  "use strict";

  /* -------------------------
     Wbudowane MENU (zamiast menu.json)
     ------------------------- */
  const MENU_CATALOG = {
    "schemaVersion": "1.0",
    "currency": "PLN",
    "items": [
      { "category": "kawa-herbata", "categoryLabel": "Kawa", "title": "Espresso", "tag": "espresso", "desc": "35 ml", "price": 11 },
      { "category": "kawa-herbata", "categoryLabel": "Kawa", "title": "Podw√≥jne espresso", "tag": "espresso", "desc": "70 ml", "price": 16 },
      { "category": "kawa-herbata", "categoryLabel": "Kawa", "title": "Affogato (espresso z lodami)", "tag": "deser kawowy", "desc": "", "price": "22/27",
        "variants": [
          { "label": "wariant 1", "price": 22, "size": null },
          { "label": "wariant 2", "price": 27, "size": null }
        ]
      },
      { "category": "kawa-herbata", "categoryLabel": "Kawa", "title": "Kawa czarna", "tag": "klasyka", "desc": "200/300 ml", "price": "12/17",
        "variants": [
          { "label": "200", "price": 12, "size": "200" },
          { "label": "300 ml", "price": 17, "size": "300 ml" }
        ]
      },
      { "category": "kawa-herbata", "categoryLabel": "Kawa", "title": "Kawa bia≈Ça", "tag": "klasyka", "desc": "200/300 ml", "price": "12/17",
        "variants": [
          { "label": "200", "price": 12, "size": "200" },
          { "label": "300 ml", "price": 17, "size": "300 ml" }
        ]
      },
      { "category": "kawa-herbata", "categoryLabel": "Kawa", "title": "Cappuccino", "tag": "klasyka", "desc": "200/300 ml", "price": "13/18",
        "variants": [
          { "label": "200", "price": 13, "size": "200" },
          { "label": "300 ml", "price": 18, "size": "300 ml" }
        ]
      },
      { "category": "kawa-herbata", "categoryLabel": "Kawa", "title": "Latte", "tag": "klasyka", "desc": "200/300 ml", "price": "13/18",
        "variants": [
          { "label": "200", "price": 13, "size": "200" },
          { "label": "300 ml", "price": 18, "size": "300 ml" }
        ]
      },
      { "category": "kawa-herbata", "categoryLabel": "Kawa", "title": "Kawa mro≈ºona", "tag": "na zimno", "desc": "300 ml", "price": 26 },
      { "category": "kawa-herbata", "categoryLabel": "Kawa", "title": "Frappe s≈Çony karmel", "tag": "na zimno", "desc": "Podw√≥jne espresso, kostki lodu, mleko, s≈Çony karmel", "price": 27 },
      { "category": "kawa-herbata", "categoryLabel": "Kawa", "title": "GorƒÖca czekolada", "tag": "na ciep≈Ço", "desc": "200 ml", "price": 21 },
      { "category": "kawa-herbata", "categoryLabel": "Kawa", "title": "Dodatkowe espresso", "tag": "dodatek", "desc": "", "price": 5 },

      { "category": "kawa-herbata", "categoryLabel": "Herbata", "title": "Zielona", "tag": "klasyka", "desc": "", "price": 15 },
      { "category": "kawa-herbata", "categoryLabel": "Herbata", "title": "English breakfast", "tag": "klasyka", "desc": "", "price": 15 },
      { "category": "kawa-herbata", "categoryLabel": "Herbata", "title": "Piekielna herbata", "tag": "rozgrzewajƒÖca", "desc": "", "price": 22 },
      { "category": "kawa-herbata", "categoryLabel": "Herbata", "title": "Czort", "tag": "rozgrzewajƒÖca", "desc": "", "price": 22 },
      { "category": "kawa-herbata", "categoryLabel": "Herbata", "title": "Mon Cheri", "tag": "rozgrzewajƒÖca", "desc": "", "price": 22 },
      { "category": "kawa-herbata", "categoryLabel": "Herbata", "title": "Domowa herbata mro≈ºona", "tag": "na zimno", "desc": "500 ml", "price": 26 },

      { "category": "kawa-herbata", "categoryLabel": "Matcha", "title": "Matcha latte", "tag": "matcha", "desc": "", "price": 20 },
      { "category": "kawa-herbata", "categoryLabel": "Matcha", "title": "Iced matcha", "tag": "matcha", "desc": "", "price": 25 },

      { "category": "napoje-soki", "categoryLabel": "Lemoniada", "title": "Cytrusowa", "tag": "lemoniada", "desc": "400/1200 ml", "price": "15/30",
        "variants": [
          { "label": "400", "price": 15, "size": "400" },
          { "label": "1200 ml", "price": 30, "size": "1200 ml" }
        ]
      },
      { "category": "napoje-soki", "categoryLabel": "Lemoniada", "title": "Arbuzowa", "tag": "lemoniada", "desc": "400/1200 ml", "price": "17/35",
        "variants": [
          { "label": "400", "price": 17, "size": "400" },
          { "label": "1200 ml", "price": 35, "size": "1200 ml" }
        ]
      },
      { "category": "napoje-soki", "categoryLabel": "Lemoniada", "title": "Ananasowa", "tag": "lemoniada", "desc": "400/1200 ml", "price": "17/35",
        "variants": [
          { "label": "400", "price": 17, "size": "400" },
          { "label": "1200 ml", "price": 35, "size": "1200 ml" }
        ]
      },
      { "category": "napoje-soki", "categoryLabel": "Lemoniada", "title": "Gruszkowa", "tag": "lemoniada", "desc": "400/1200 ml", "price": "17/35",
        "variants": [
          { "label": "400", "price": 17, "size": "400" },
          { "label": "1200 ml", "price": 35, "size": "1200 ml" }
        ]
      },
      { "category": "napoje-soki", "categoryLabel": "Lemoniada", "title": "Malinowa zimna", "tag": "lemoniada", "desc": "400/1200 ml", "price": "17/35",
        "variants": [
          { "label": "400", "price": 17, "size": "400" },
          { "label": "1200 ml", "price": 35, "size": "1200 ml" }
        ]
      },
      { "category": "napoje-soki", "categoryLabel": "Lemoniada", "title": "Malinowa ciep≈Ça", "tag": "lemoniada", "desc": "400/1200 ml", "price": "17/35",
        "variants": [
          { "label": "400", "price": 17, "size": "400" },
          { "label": "1200 ml", "price": 35, "size": "1200 ml" }
        ]
      },

      { "category": "napoje-soki", "categoryLabel": "Napoje", "title": "Woda z kranu", "tag": "", "desc": "", "price": 0 },
      { "category": "napoje-soki", "categoryLabel": "Napoje", "title": "Woda niegazowana", "tag": "", "desc": "500 ml", "price": 8 },
      { "category": "napoje-soki", "categoryLabel": "Napoje", "title": "Woda gazowana", "tag": "", "desc": "500 ml", "price": 8 },
      { "category": "napoje-soki", "categoryLabel": "Napoje", "title": "Pepsi", "tag": "", "desc": "330 ml", "price": 9 },
      { "category": "napoje-soki", "categoryLabel": "Napoje", "title": "Pepsi Max", "tag": "", "desc": "330 ml", "price": 9 },

      { "category": "napoje-soki", "categoryLabel": "≈öwie≈ºe soki", "title": "Pomara≈Ñczowy", "tag": "≈õwie≈ºy sok", "desc": "300 ml", "price": 19 },
      { "category": "napoje-soki", "categoryLabel": "≈öwie≈ºe soki", "title": "Grejpfrutowy", "tag": "≈õwie≈ºy sok", "desc": "300 ml", "price": 22 },
      { "category": "napoje-soki", "categoryLabel": "≈öwie≈ºe soki", "title": "Pomara≈Ñczowo-grejpfrutowy", "tag": "≈õwie≈ºy sok", "desc": "300 ml", "price": 22 },
      { "category": "napoje-soki", "categoryLabel": "≈öwie≈ºe soki", "title": "Jab≈Çkowy", "tag": "≈õwie≈ºy sok", "desc": "300 ml", "price": 19 },
      { "category": "napoje-soki", "categoryLabel": "≈öwie≈ºe soki", "title": "Jab≈Çkowo-gruszkowy", "tag": "≈õwie≈ºy sok", "desc": "300 ml", "price": 19 },
      { "category": "napoje-soki", "categoryLabel": "≈öwie≈ºe soki", "title": "Marchewka-jab≈Çko-pomara≈Ñcza", "tag": "≈õwie≈ºy sok", "desc": "300 ml", "price": 19 },
      { "category": "napoje-soki", "categoryLabel": "≈öwie≈ºe soki", "title": "Burak-jab≈Çko-pomara≈Ñcza-seler", "tag": "≈õwie≈ºy sok", "desc": "300 ml", "price": 22 },
      { "category": "napoje-soki", "categoryLabel": "≈öwie≈ºe soki", "title": "Jab≈Çko-seler-kiwi", "tag": "≈õwie≈ºy sok", "desc": "300 ml", "price": 22 },

      { "category": "napoje-soki", "categoryLabel": "Smoothies", "title": "Zielony", "tag": "smoothies", "desc": "350 ml ‚Ä¢ szpinak, kiwi, pomara≈Ñcza, gruszka", "price": 29 },
      { "category": "napoje-soki", "categoryLabel": "Smoothies", "title": "≈ª√≥≈Çty", "tag": "smoothies", "desc": "350 ml ‚Ä¢ banan, jab≈Çko, ananas, mango", "price": 29 },
      { "category": "napoje-soki", "categoryLabel": "Smoothies", "title": "Pomara≈Ñczowy", "tag": "smoothies", "desc": "350 ml ‚Ä¢ banan, pomara≈Ñcza, mango, nerkowce, limonka", "price": 29 },
      { "category": "napoje-soki", "categoryLabel": "Smoothies", "title": "Czerwony", "tag": "smoothies", "desc": "350 ml ‚Ä¢ truskawki, maliny, banan, ananas", "price": 29 },

      { "category": "napoje-soki", "categoryLabel": "Piwo", "title": "Corona", "tag": "piwo", "desc": "330 ml", "price": 15 },
      { "category": "napoje-soki", "categoryLabel": "Piwo", "title": "Piwo bezalkoholowe", "tag": "piwo", "desc": "", "price": 14 },
      { "category": "napoje-soki", "categoryLabel": "Piwo", "title": "IPA", "tag": "piwo", "desc": "0,5 l", "price": 19 },
      { "category": "napoje-soki", "categoryLabel": "Piwo", "title": "Lager", "tag": "piwo", "desc": "Zapytaj o dostƒôpno≈õƒá", "price": 17 },

      { "category": "napoje-soki", "categoryLabel": "Wino & Aperitiff", "title": "Sauvignon blanc (bia≈Çe wytrawne) ‚Äì Skarby Mo≈Çdawii", "tag": "wino-aperitiff", "desc": "170/500/700 ml", "price": "22/64/89",
        "variants": [
          { "label": "170", "price": 22, "size": "170" },
          { "label": "500", "price": 64, "size": "500" },
          { "label": "700 ml", "price": 89, "size": "700 ml" }
        ]
      },
      { "category": "napoje-soki", "categoryLabel": "Wino & Aperitiff", "title": "Cabernet sauvignon (czerwone wytrawne) ‚Äì Skarby Mo≈Çdawii", "tag": "wino-aperitiff", "desc": "170/500/700 ml", "price": "22/64/89",
        "variants": [
          { "label": "170", "price": 22, "size": "170" },
          { "label": "500", "price": 64, "size": "500" },
          { "label": "700 ml", "price": 89, "size": "700 ml" }
        ]
      },
      { "category": "napoje-soki", "categoryLabel": "Wino & Aperitiff", "title": "Hugo", "tag": "wino-aperitiff", "desc": "Prosecco, woda gazowana, syrop z czarnego bzu, miƒôta i limonka", "price": 35 },
      { "category": "napoje-soki", "categoryLabel": "Wino & Aperitiff", "title": "Prosecco (wytrawne wino musujƒÖce)", "tag": "wino-aperitiff", "desc": "", "price": 26 },

      { "category": "shake", "categoryLabel": "Shakes", "title": "≈ömietankowy", "tag": "klasyka", "desc": "", "price": 18 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Waniliowy", "tag": "klasyka", "desc": "", "price": 19 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Czekoladowy", "tag": "klasyka", "desc": "", "price": 19 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Straciatella", "tag": "klasyka", "desc": "", "price": 19 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Cha≈Çwa", "tag": "klasyka", "desc": "", "price": 22 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Kr√≥wka", "tag": "klasyka", "desc": "", "price": 22 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Daim", "tag": "klasyka", "desc": "", "price": 22 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Milky Way", "tag": "klasyka", "desc": "", "price": 22 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Oreo", "tag": "klasyka", "desc": "", "price": 22 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Snickers", "tag": "klasyka", "desc": "", "price": 22 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Ptasie mleczko waniliowe", "tag": "klasyka", "desc": "", "price": 22 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Kinder Bueno", "tag": "klasyka", "desc": "", "price": 24 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Reese's Peanut Butter", "tag": "klasyka", "desc": "", "price": 24 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Nutella", "tag": "klasyka", "desc": "", "price": 24 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Raffaello", "tag": "klasyka", "desc": "", "price": 24 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Skittles", "tag": "klasyka", "desc": "", "price": 24 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Ferrero Rocher", "tag": "klasyka", "desc": "", "price": 24 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Maxi King", "tag": "klasyka", "desc": "", "price": 24 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Mas≈Ço orzechowe", "tag": "klasyka", "desc": "", "price": 24 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Kawowy", "tag": "klasyka", "desc": "", "price": 24 },

      { "category": "shake", "categoryLabel": "Shakes", "title": "Ciasteczkowy Potw√≥r", "tag": "vip", "desc": "", "price": 37 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Pistacjusz", "tag": "vip", "desc": "", "price": 37 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Marshall", "tag": "vip", "desc": "", "price": 37 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Cringe", "tag": "vip", "desc": "", "price": 37 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Cheesecake", "tag": "vip", "desc": "", "price": 37 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Gonzo", "tag": "vip", "desc": "", "price": 37 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Johny Pierniczony", "tag": "vip", "desc": "", "price": 37 },

      { "category": "shake", "categoryLabel": "Shakes", "title": "Banan + maliny", "tag": "best-of", "desc": "", "price": 26 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Mango + truskawki", "tag": "best-of", "desc": "", "price": 26 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Kiwi + mango", "tag": "best-of", "desc": "", "price": 26 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Kinder bueno + maliny", "tag": "best-of", "desc": "", "price": 28 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Oreo + mas≈Ço orzechowe", "tag": "best-of", "desc": "", "price": 28 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Kawa + s≈Çony karmel", "tag": "best-of", "desc": "", "price": 29 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Kawa + Nutella", "tag": "best-of", "desc": "", "price": 29 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Ptasie mleczko + maliny", "tag": "best-of", "desc": "", "price": 28 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Raffaello + jagody", "tag": "best-of", "desc": "", "price": 28 },

      { "category": "shake", "categoryLabel": "Shakes", "title": "Bananowy", "tag": "owocowe", "desc": "", "price": 22 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Czarna porzeczka", "tag": "owocowe", "desc": "", "price": 22 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Malinowy", "tag": "owocowe", "desc": "", "price": 22 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Mango", "tag": "owocowe", "desc": "", "price": 22 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Truskawkowy", "tag": "owocowe", "desc": "", "price": 22 },
      { "category": "shake", "categoryLabel": "Shakes", "title": "Jagodowy", "tag": "owocowe", "desc": "", "price": 22 },

      { "category": "shake", "categoryLabel": "Shakes proteinowe", "title": "Jagodowy muffin", "tag": "proteinowe", "desc": "", "price": 32 },
      { "category": "shake", "categoryLabel": "Shakes proteinowe", "title": "S≈Çony karmel", "tag": "proteinowe", "desc": "", "price": 28 },
      { "category": "shake", "categoryLabel": "Shakes proteinowe", "title": "Truskawkowe love", "tag": "proteinowe", "desc": "", "price": 28 },

      { "category": "deser", "categoryLabel": "Lody w≈Çoskie", "title": "Lody w≈Çoskie ≈õmietankowe (ma≈Çe)", "tag": "lody-wloskie", "desc": "150 g", "price": 11 },
      { "category": "deser", "categoryLabel": "Lody w≈Çoskie", "title": "Lody w≈Çoskie ≈õmietankowe (du≈ºe)", "tag": "lody-wloskie", "desc": "250 g", "price": 16 },
      { "category": "deser", "categoryLabel": "Dodatki", "title": "Mus owocowy lub polewa", "tag": "lody-wloskie", "desc": "", "price": 6 },
      { "category": "deser", "categoryLabel": "Dodatki", "title": "M&Ms", "tag": "lody-wloskie", "desc": "", "price": 6 },
      { "category": "deser", "categoryLabel": "Dodatki", "title": "Owoce", "tag": "lody-wloskie", "desc": "", "price": 14 },
      { "category": "deser", "categoryLabel": "Dodatki", "title": "Bita ≈õmietana", "tag": "lody-wloskie", "desc": "", "price": 6 },
      { "category": "deser", "categoryLabel": "Desery lodowe", "title": "Troll", "tag": "desery-lodowe", "desc": "", "price": 24 },
      { "category": "deser", "categoryLabel": "Desery lodowe", "title": "Owocowa aleja", "tag": "desery-lodowe", "desc": "", "price": 38 },
      { "category": "deser", "categoryLabel": "Desery lodowe", "title": "Grzeszna truskawka", "tag": "desery-lodowe", "desc": "", "price": 38 },
      { "category": "deser", "categoryLabel": "Desery lodowe", "title": "Oreo Sundae", "tag": "desery-lodowe", "desc": "", "price": 29 },

      { "category": "deser", "categoryLabel": "Gofry ameryka≈Ñskie", "title": "Z syropem klonowym, jajkiem sadzonym i bekonem", "tag": "gofry-amerykanskie", "desc": "p√≥≈Ç / ca≈Çy", "price": "28/44",
        "variants": [
          { "label": "p√≥≈Ç", "price": 28, "size": "p√≥≈Ç" },
          { "label": "ca≈Çy", "price": 44, "size": "ca≈Çy" }
        ]
      },
      { "category": "deser", "categoryLabel": "Gofry ameryka≈Ñskie", "title": "American Pie z pieczonymi jab≈Çkami, cynamonem, domowƒÖ kruszonkƒÖ i lodami", "tag": "gofry-amerykanskie", "desc": "p√≥≈Ç / ca≈Çy", "price": "27/49",
        "variants": [
          { "label": "p√≥≈Ç", "price": 27, "size": "p√≥≈Ç" },
          { "label": "ca≈Çy", "price": 49, "size": "ca≈Çy" }
        ]
      },
      { "category": "deser", "categoryLabel": "Gofry ameryka≈Ñskie", "title": "Z d≈ºemem z czarnej porzeczki i polewƒÖ Lotus Biscoff", "tag": "gofry-amerykanskie", "desc": "p√≥≈Ç / ca≈Çy", "price": "26/48",
        "variants": [
          { "label": "p√≥≈Ç", "price": 26, "size": "p√≥≈Ç" },
          { "label": "ca≈Çy", "price": 48, "size": "ca≈Çy" }
        ]
      },
      { "category": "deser", "categoryLabel": "Gofry ameryka≈Ñskie", "title": "Dubajski z truskawkami", "tag": "gofry-amerykanskie", "desc": "p√≥≈Ç / ca≈Çy", "price": "32/54",
        "variants": [
          { "label": "p√≥≈Ç", "price": 32, "size": "p√≥≈Ç" },
          { "label": "ca≈Çy", "price": 54, "size": "ca≈Çy" }
        ]
      },
      { "category": "deser", "categoryLabel": "Gofry ameryka≈Ñskie", "title": "Cheesecake z serkiem Philadelphia, masƒÖ ciasteczkowƒÖ, kruszonkƒÖ i truskawkami", "tag": "gofry-amerykanskie", "desc": "p√≥≈Ç / ca≈Çy", "price": "28/50",
        "variants": [
          { "label": "p√≥≈Ç", "price": 28, "size": "p√≥≈Ç" },
          { "label": "ca≈Çy", "price": 50, "size": "ca≈Çy" }
        ]
      },

      { "category": "deser", "categoryLabel": "Pancakes", "title": "Z syropem klonowym i lodami", "tag": "pancakes", "desc": "3 szt.", "price": 29 },
      { "category": "deser", "categoryLabel": "Pancakes", "title": "Z owocami, musem truskawkowym i lodami", "tag": "pancakes", "desc": "3 szt.", "price": 36 },
      { "category": "deser", "categoryLabel": "Pancakes", "title": "Z NutellƒÖ, truskawkami i lodami", "tag": "pancakes", "desc": "3 szt.", "price": 36 },
      { "category": "deser", "categoryLabel": "Pancakes", "title": "Z masƒÖ Kinder Bueno, malinami i lodami", "tag": "pancakes", "desc": "3 szt.", "price": 39 },
      { "category": "deser", "categoryLabel": "Pancakes", "title": "Z masƒÖ Raffaello, truskawkami i lodami", "tag": "pancakes", "desc": "3 szt.", "price": 39 },
      { "category": "deser", "categoryLabel": "Pancakes", "title": "Z dubajskƒÖ pistacjƒÖ i truskawkami", "tag": "pancakes", "desc": "3 szt.", "price": 39 },
      { "category": "deser", "categoryLabel": "Pancakes", "title": "Hello USA", "tag": "pancakes", "desc": "syrop klonowy, bekon, 2 jaja sadzone", "price": 39 },

      { "category": "texmex", "categoryLabel": "Quesadillas", "title": "Pollo", "tag": "quesadillas", "desc": "", "price": 45 },
      { "category": "texmex", "categoryLabel": "Quesadillas", "title": "Torro", "tag": "quesadillas", "desc": "", "price": 46 },
      { "category": "texmex", "categoryLabel": "Quesadillas", "title": "Camaron", "tag": "quesadillas", "desc": "", "price": 49 },
      { "category": "texmex", "categoryLabel": "Quesadillas", "title": "Verduras", "tag": "quesadillas", "desc": "", "price": 42 },

      { "category": "texmex", "categoryLabel": "Fajita", "title": "Fajita z kurczakiem", "tag": "fajita", "desc": "", "price": 59 },
      { "category": "texmex", "categoryLabel": "Fajita", "title": "Fajita z krewetkami", "tag": "fajita", "desc": "", "price": 69 },
      { "category": "texmex", "categoryLabel": "Fajita", "title": "Fajita z polƒôdwicƒÖ wo≈ÇowƒÖ", "tag": "fajita", "desc": "", "price": 79 },

      { "category": "texmex", "categoryLabel": "Churros", "title": "Churros (6 szt.) z sosem czekoladowym i truskawkami", "tag": "churros", "desc": "", "price": 33 },
      { "category": "texmex", "categoryLabel": "Churros", "title": "Churros (6 szt.) ze s≈Çonym karmelem i precelkami", "tag": "churros", "desc": "", "price": 32 },

      { "category": "texmex", "categoryLabel": "Pasta", "title": "Tagiatelle z krewetkami", "tag": "pasta", "desc": "", "price": 51 },
      { "category": "texmex", "categoryLabel": "Pasta", "title": "Vege Pasta", "tag": "pasta", "desc": "", "price": 44 },

      { "category": "texmex", "categoryLabel": "NY Chinatown Stir Fry", "title": "Vege (z nerkowcami)", "tag": "stir-fry", "desc": "", "price": 39 },
      { "category": "texmex", "categoryLabel": "NY Chinatown Stir Fry", "title": "Z kurczakiem 90g", "tag": "stir-fry", "desc": "", "price": 47 },
      { "category": "texmex", "categoryLabel": "NY Chinatown Stir Fry", "title": "Z wo≈ÇowinƒÖ 90g", "tag": "stir-fry", "desc": "", "price": 55 },
      { "category": "texmex", "categoryLabel": "NY Chinatown Stir Fry", "title": "Z krewetkami (16/20) 7 szt.", "tag": "stir-fry", "desc": "", "price": 51 },
      { "category": "texmex", "categoryLabel": "Dodatki", "title": "Dodatkowe nerkowce 20g", "tag": "stir-fry", "desc": "", "price": 8 },

      { "category": "texmex", "categoryLabel": "Sa≈Çaty", "title": "Cezar", "tag": "salaty", "desc": "", "price": 49 },
      { "category": "texmex", "categoryLabel": "Sa≈Çaty", "title": "Vege Cezar", "tag": "salaty", "desc": "", "price": 42 },
      { "category": "texmex", "categoryLabel": "Sa≈Çaty", "title": "Ale burak", "tag": "salaty", "desc": "", "price": 44 },
      { "category": "texmex", "categoryLabel": "Sa≈Çaty", "title": "Alabama", "tag": "salaty", "desc": "", "price": 51 },

      { "category": "kanapki", "categoryLabel": "Startery", "title": "Frytki", "tag": "startery", "desc": "150 g", "price": 15 },
      { "category": "kanapki", "categoryLabel": "Startery", "title": "Frytki z batat√≥w", "tag": "startery", "desc": "150 g", "price": 19 },
      { "category": "kanapki", "categoryLabel": "Startery", "title": "Frytki z serem, bekonem i majonezem sriracha", "tag": "startery", "desc": "", "price": 30 },
      { "category": "kanapki", "categoryLabel": "Startery", "title": "KrƒÖ≈ºki cebulowe (5 szt.) z sosem sweet chili", "tag": "startery", "desc": "", "price": 18 },
      { "category": "kanapki", "categoryLabel": "Startery", "title": "Krewetki w tempurze (3 szt.) z sosem sweet chili", "tag": "startery", "desc": "", "price": 21 },
      { "category": "kanapki", "categoryLabel": "Startery", "title": "Krewetki w tempurze (6 szt.) z sosem sweet chili", "tag": "startery", "desc": "", "price": 39 },
      { "category": "kanapki", "categoryLabel": "Startery", "title": "Nachos z serem, guacamole, ≈õmietanƒÖ, salsƒÖ i jalapeno", "tag": "startery", "desc": "", "price": 41 },
      { "category": "kanapki", "categoryLabel": "Startery", "title": "Nachos z chili con carne, serem, ≈õmietanƒÖ, guacamole i jalapeno", "tag": "startery", "desc": "", "price": 49 },

      { "category": "kanapki", "categoryLabel": "Kanapki", "title": "Rostbef", "tag": "kanapki", "desc": "60 g / 100 g", "price": "42/58",
        "variants": [
          { "label": "60 g", "price": 42, "size": "60 g" },
          { "label": "100 g", "price": 58, "size": "100 g" }
        ]
      },
      { "category": "kanapki", "categoryLabel": "Kanapki", "title": "Cotto", "tag": "kanapki", "desc": "70 g / 120 g", "price": "37/49",
        "variants": [
          { "label": "70 g", "price": 37, "size": "70 g" },
          { "label": "120 g", "price": 49, "size": "120 g" }
        ]
      },
      { "category": "kanapki", "categoryLabel": "Kanapki", "title": "Kura", "tag": "kanapki", "desc": "", "price": 46 },
      { "category": "kanapki", "categoryLabel": "Kanapki", "title": "Club sandwich", "tag": "kanapki", "desc": "", "price": 38 },
      { "category": "kanapki", "categoryLabel": "Kanapki", "title": "Cotto club", "tag": "kanapki", "desc": "", "price": 36 },
      { "category": "kanapki", "categoryLabel": "Kanapki", "title": "Vege club", "tag": "kanapki", "desc": "", "price": 36 },

      { "category": "kanapki", "categoryLabel": "Dania g≈Ç√≥wne", "title": "Tatar z polƒôdwicy wo≈Çowej", "tag": "dania-glowne", "desc": "100 g", "price": 51 },
      { "category": "kanapki", "categoryLabel": "Dania g≈Ç√≥wne", "title": "≈ªebro wieprzowe", "tag": "dania-glowne", "desc": "450 g", "price": 75 },
      { "category": "kanapki", "categoryLabel": "Dania g≈Ç√≥wne", "title": "Stek", "tag": "dania-glowne", "desc": "", "price": 125 },
      { "category": "kanapki", "categoryLabel": "Dania g≈Ç√≥wne", "title": "Kurczak supreme", "tag": "dania-glowne", "desc": "", "price": 65 },

      { "category": "kanapki", "categoryLabel": "Zestawy", "title": "Burger + frytki lub sa≈Çatka", "tag": "zestawy", "desc": "oszczƒôdzasz 5 PLN", "price": "+12",
        "variants": [
          { "label": "dop≈Çata", "price": 12.0, "size": null }
        ]
      },
      { "category": "kanapki", "categoryLabel": "Zestawy", "title": "Burger + frytki/sa≈Çatka + lemoniada cytrusowa", "tag": "zestawy", "desc": "oszczƒôdzasz 10 PLN", "price": "+22",
        "variants": [
          { "label": "dop≈Çata", "price": 22.0, "size": null }
        ]
      },
      { "category": "kanapki", "categoryLabel": "Zestawy", "title": "Zamie≈Ñ frytki na krƒÖ≈ºki cebulowe", "tag": "zestawy", "desc": "", "price": 15 },
      { "category": "kanapki", "categoryLabel": "Zestawy", "title": "Zamie≈Ñ frytki na mini nachos", "tag": "zestawy", "desc": "", "price": 18 },
      { "category": "kanapki", "categoryLabel": "Zestawy", "title": "Zamie≈Ñ frytki na bataty", "tag": "zestawy", "desc": "", "price": 14 },

      { "category": "burger", "categoryLabel": "Burgery wo≈Çowe Black Angus", "title": "Prostak", "tag": "wolowy", "desc": "ma≈Çy / ≈õredni / du≈ºy", "price": "30/38/46",
        "variants": [
          { "label": "ma≈Çy", "price": 30, "size": "ma≈Çy" },
          { "label": "≈õredni", "price": 38, "size": "≈õredni" },
          { "label": "du≈ºy", "price": 46, "size": "du≈ºy" }
        ]
      },
      { "category": "burger", "categoryLabel": "Burgery wo≈Çowe Black Angus", "title": "Sergio", "tag": "wolowy", "desc": "ma≈Çy / ≈õredni / du≈ºy", "price": "32/40/48",
        "variants": [
          { "label": "ma≈Çy", "price": 32, "size": "ma≈Çy" },
          { "label": "≈õredni", "price": 40, "size": "≈õredni" },
          { "label": "du≈ºy", "price": 48, "size": "du≈ºy" }
        ]
      },
      { "category": "burger", "categoryLabel": "Burgery wo≈Çowe Black Angus", "title": "Boston", "tag": "wolowy", "desc": "ma≈Çy / ≈õredni / du≈ºy", "price": "34/42/50",
        "variants": [
          { "label": "ma≈Çy", "price": 34, "size": "ma≈Çy" },
          { "label": "≈õredni", "price": 42, "size": "≈õredni" },
          { "label": "du≈ºy", "price": 50, "size": "du≈ºy" }
        ]
      },
      { "category": "burger", "categoryLabel": "Burgery wo≈Çowe Black Angus", "title": "Ple≈õniak", "tag": "wolowy", "desc": "ma≈Çy / ≈õredni / du≈ºy", "price": "38/46/54",
        "variants": [
          { "label": "ma≈Çy", "price": 38, "size": "ma≈Çy" },
          { "label": "≈õredni", "price": 46, "size": "≈õredni" },
          { "label": "du≈ºy", "price": 54, "size": "du≈ºy" }
        ]
      },
      { "category": "burger", "categoryLabel": "Burgery wo≈Çowe Black Angus", "title": "Bajpas", "tag": "wolowy", "desc": "ma≈Çy / ≈õredni / du≈ºy", "price": "36/44/52",
        "variants": [
          { "label": "ma≈Çy", "price": 36, "size": "ma≈Çy" },
          { "label": "≈õredni", "price": 44, "size": "≈õredni" },
          { "label": "du≈ºy", "price": 52, "size": "du≈ºy" }
        ]
      },
      { "category": "burger", "categoryLabel": "Burgery wo≈Çowe Black Angus", "title": "Burakoza", "tag": "wolowy", "desc": "ma≈Çy / ≈õredni / du≈ºy", "price": "38/46/54",
        "variants": [
          { "label": "ma≈Çy", "price": 38, "size": "ma≈Çy" },
          { "label": "≈õredni", "price": 46, "size": "≈õredni" },
          { "label": "du≈ºy", "price": 54, "size": "du≈ºy" }
        ]
      },
      { "category": "burger", "categoryLabel": "Burgery wo≈Çowe Black Angus", "title": "New York", "tag": "wolowy", "desc": "ma≈Çy / ≈õredni / du≈ºy", "price": "38/46/54",
        "variants": [
          { "label": "ma≈Çy", "price": 38, "size": "ma≈Çy" },
          { "label": "≈õredni", "price": 46, "size": "≈õredni" },
          { "label": "du≈ºy", "price": 54, "size": "du≈ºy" }
        ]
      },
      { "category": "burger", "categoryLabel": "Burgery wo≈Çowe Black Angus", "title": "Z≈Çodziej", "tag": "wolowy", "desc": "ma≈Çy / ≈õredni / du≈ºy", "price": "38/46/54",
        "variants": [
          { "label": "ma≈Çy", "price": 38, "size": "ma≈Çy" },
          { "label": "≈õredni", "price": 46, "size": "≈õredni" },
          { "label": "du≈ºy", "price": 54, "size": "du≈ºy" }
        ]
      },
      { "category": "burger", "categoryLabel": "Burgery wo≈Çowe Black Angus", "title": "Missisipi", "tag": "wolowy", "desc": "ma≈Çy / ≈õredni / du≈ºy", "price": "38/46/54",
        "variants": [
          { "label": "ma≈Çy", "price": 38, "size": "ma≈Çy" },
          { "label": "≈õredni", "price": 46, "size": "≈õredni" },
          { "label": "du≈ºy", "price": 54, "size": "du≈ºy" }
        ]
      },

      { "category": "burger", "categoryLabel": "Burgery z kurczakiem", "title": "Kura", "tag": "kurczak", "desc": "", "price": 43 },
      { "category": "burger", "categoryLabel": "Burgery z kurczakiem", "title": "≈ª√≥≈Çtodzi√≥b", "tag": "kurczak", "desc": "", "price": 43 },

      { "category": "sniadania", "categoryLabel": "Napoje do ≈õniadania", "title": "Kawa filtrowana (z dolewkƒÖ)", "tag": "sniadania", "desc": "", "price": 12 },
      { "category": "sniadania", "categoryLabel": "Napoje do ≈õniadania", "title": "Herbata ≈õniadaniowa", "tag": "sniadania", "desc": "", "price": 9 },
      { "category": "sniadania", "categoryLabel": "Napoje do ≈õniadania", "title": "≈öwie≈ºy sok", "tag": "sniadania", "desc": "0,2 l", "price": 18 },
      { "category": "sniadania", "categoryLabel": "Napoje do ≈õniadania", "title": "Mimoza", "tag": "sniadania", "desc": "", "price": 31 },

      { "category": "sniadania", "categoryLabel": "≈öniadania", "title": "Granola", "tag": "sniadania", "desc": "", "price": 44 },
      { "category": "sniadania", "categoryLabel": "≈öniadania", "title": "Tost francuski w panko", "tag": "sniadania", "desc": "", "price": 44 },
      { "category": "sniadania", "categoryLabel": "≈öniadania", "title": "Jajito burrito", "tag": "sniadania", "desc": "", "price": 37 },
      { "category": "sniadania", "categoryLabel": "≈öniadania", "title": "Czerwona szakszuka", "tag": "sniadania", "desc": "", "price": 39 },
      { "category": "sniadania", "categoryLabel": "≈öniadania", "title": "Egg royal", "tag": "sniadania", "desc": "", "price": 45 },
      { "category": "sniadania", "categoryLabel": "≈öniadania", "title": "Jajecznica", "tag": "sniadania", "desc": "", "price": 33 },
      { "category": "sniadania", "categoryLabel": "≈öniadania", "title": "Omlet francuski", "tag": "sniadania", "desc": "", "price": 37 },

      { "category": "sniadania", "categoryLabel": "Kanapki ≈õniadaniowe", "title": "Rostbef", "tag": "kanapki-sniadaniowe", "desc": "60 g / 100 g", "price": "42/58",
        "variants": [
          { "label": "60 g", "price": 42, "size": "60 g" },
          { "label": "100 g", "price": 58, "size": "100 g" }
        ]
      },
      { "category": "sniadania", "categoryLabel": "Kanapki ≈õniadaniowe", "title": "Cotto", "tag": "kanapki-sniadaniowe", "desc": "70 g / 120 g", "price": "37/49",
        "variants": [
          { "label": "70 g", "price": 37, "size": "70 g" },
          { "label": "120 g", "price": 49, "size": "120 g" }
        ]
      },
      { "category": "sniadania", "categoryLabel": "Kanapki ≈õniadaniowe", "title": "Kura", "tag": "kanapki-sniadaniowe", "desc": "", "price": 46 },
      { "category": "sniadania", "categoryLabel": "Kanapki ≈õniadaniowe", "title": "Club sandwich", "tag": "kanapki-sniadaniowe", "desc": "", "price": 38 },
      { "category": "sniadania", "categoryLabel": "Kanapki ≈õniadaniowe", "title": "Cotto club", "tag": "kanapki-sniadaniowe", "desc": "", "price": 36 },
      { "category": "sniadania", "categoryLabel": "Kanapki ≈õniadaniowe", "title": "Vege club", "tag": "kanapki-sniadaniowe", "desc": "", "price": 36 },

      { "category": "sniadania", "categoryLabel": "Full milkshake breakfast", "title": "Du≈ºy full milkshake breakfast", "tag": "zestaw-sniadaniowy", "desc": "", "price": 53 },
      { "category": "sniadania", "categoryLabel": "Full milkshake breakfast", "title": "Ma≈Çy full milkshake breakfast", "tag": "zestaw-sniadaniowy", "desc": "", "price": 42 },

      { "category": "sniadania", "categoryLabel": "Chiquita", "title": "Chiquita", "tag": "chiquita", "desc": "", "price": 41 },
      { "category": "sniadania", "categoryLabel": "Chiquita", "title": "Chiquita z chorizo", "tag": "chiquita", "desc": "80 g", "price": 39 },

      { "category": "sniadania", "categoryLabel": "≈öniadanie KETO ‚Äì dodatki", "title": "Frankfurterka", "tag": "sniadania-keto", "desc": "", "price": 7 },
      { "category": "sniadania", "categoryLabel": "≈öniadanie KETO ‚Äì dodatki", "title": "Chorizo", "tag": "sniadania-keto", "desc": "70 g", "price": 8 },
      { "category": "sniadania", "categoryLabel": "≈öniadanie KETO ‚Äì dodatki", "title": "¬Ω awokado", "tag": "sniadania-keto", "desc": "", "price": 9 },
      { "category": "sniadania", "categoryLabel": "≈öniadanie KETO ‚Äì dodatki", "title": "Twaro≈ºek", "tag": "sniadania-keto", "desc": "80 g", "price": 7 },
      { "category": "sniadania", "categoryLabel": "≈öniadanie KETO ‚Äì dodatki", "title": "Og√≥rek zielony", "tag": "sniadania-keto", "desc": "7 plastr√≥w", "price": 5 },
      { "category": "sniadania", "categoryLabel": "≈öniadanie KETO ‚Äì dodatki", "title": "Pomidorki koktajlowe", "tag": "sniadania-keto", "desc": "80 g", "price": 5 },
      { "category": "sniadania", "categoryLabel": "≈öniadanie KETO ‚Äì dodatki", "title": "Bekon", "tag": "sniadania-keto", "desc": "2 plastry", "price": 4 },
      { "category": "sniadania", "categoryLabel": "≈öniadanie KETO ‚Äì dodatki", "title": "Jajo", "tag": "sniadania-keto", "desc": "", "price": 4 },
      { "category": "sniadania", "categoryLabel": "≈öniadanie KETO ‚Äì dodatki", "title": "Mas≈Ço", "tag": "sniadania-keto", "desc": "10 g", "price": 2 },
      { "category": "sniadania", "categoryLabel": "≈öniadanie KETO ‚Äì dodatki", "title": "Chleb ma≈õlany", "tag": "sniadania-keto", "desc": "80 g", "price": 6 },
      { "category": "sniadania", "categoryLabel": "≈öniadanie KETO ‚Äì dodatki", "title": "Gravlax", "tag": "sniadania-keto", "desc": "50 g", "price": 15 }
    ]
  };

  /* -------------------------
     Nagrody (NOWE ‚Äì 3 szt.)
     ------------------------- */
  const REWARDS = [
    { id: "milkshake_30", title: "Milkshake do 30 PLN", points: 25, desc: "Realizacja: milkshake o warto≈õci do 30 PLN." },
    { id: "burger_set_60", title: "Zestaw burger do 60 PLN", points: 50, desc: "Realizacja: zestaw burger o warto≈õci do 60 PLN." },
    { id: "order_120", title: "Zam√≥wienie do 120 PLN", points: 100, desc: "Realizacja: zam√≥wienie o warto≈õci do 120 PLN." }
  ];

  /* -------------------------
     Helpers / storage
     ------------------------- */
  const LS = {
    user: "milk_user",
    points: "milk_points",
    pointsHistory: "milk_points_history",
    cart: "milk_cart",
    orders: "milk_orders",
    reservations: "milk_reservations",
    profile: "milk_profile",
    redeemed: "milk_redeemed_rewards",
    lang: "milk_lang",
    didResetHistory: "milk_points_history_reset_v1"
  };

  const $ = (sel) => document.querySelector(sel);
  const $$ = (sel) => Array.from(document.querySelectorAll(sel));

  const nowISO = () => new Date().toISOString();

  const safeJsonParse = (s, fallback) => {
    try { return JSON.parse(s); } catch { return fallback; }
  };

  const store = {
    get(key, fallback){
      const raw = localStorage.getItem(key);
      if (raw == null) return fallback;
      return safeJsonParse(raw, fallback);
    },
    set(key, val){
      localStorage.setItem(key, JSON.stringify(val));
    },
    del(key){
      localStorage.removeItem(key);
    }
  };

  const fmtPLN = (n) => {
    const num = Number(n);
    if (!Number.isFinite(num)) return String(n);
    return num.toFixed(num % 1 === 0 ? 0 : 2).replace(".", ",");
  };

  const toast = (() => {
    let tmr = null;
    const el = $("#toast");
    const title = $("#toastTitle");
    const msg = $("#toastMsg");
    const close = $("#toastClose");
    if (close) close.addEventListener("click", () => hide());

    function show(t, m){
      if (!el) return;
      title.textContent = t || "Info";
      msg.textContent = m || "";
      el.classList.add("show");
      clearTimeout(tmr);
      tmr = setTimeout(() => hide(), 3200);
    }
    function hide(){
      if (!el) return;
      el.classList.remove("show");
      clearTimeout(tmr);
      tmr = null;
    }
    return { show, hide };
  })();

  /* -------------------------
     User / auth
     ------------------------- */
  const getUser = () => store.get(LS.user, null);
  const setUser = (u) => store.set(LS.user, u);
  const isLoggedIn = () => !!(getUser() && getUser().email);

  function hashTo6Digits(str){
    // deterministyczny 6-cyfrowy Milk ID na bazie e-maila
    let h = 2166136261;
    for (let i=0;i<str.length;i++){
      h ^= str.charCodeAt(i);
      h = Math.imul(h, 16777619);
    }
    const n = Math.abs(h) % 1000000;
    return String(n).padStart(6, "0");
  }

  function getMilkIdForUser(){
    const u = getUser();
    if (!u?.email) return null;
    return hashTo6Digits(String(u.email).trim().toLowerCase());
  }

  /* -------------------------
     Points
     ------------------------- */
  function initPointsIfMissing(){
    const p = store.get(LS.points, null);
    if (p == null) store.set(LS.points, 0);
    const hist = store.get(LS.pointsHistory, null);
    if (!Array.isArray(hist)) store.set(LS.pointsHistory, []);

    // (z wcze≈õniejszych wersji) 1x reset historii ‚Äì zostawiamy, bo masz to w pamiƒôci projektu
    const did = store.get(LS.didResetHistory, false);
    if (!did){
      store.set(LS.pointsHistory, []);
      store.set(LS.didResetHistory, true);
    }
  }

  const getPoints = () => Number(store.get(LS.points, 0) || 0);
  const setPoints = (n) => store.set(LS.points, Math.max(0, Number(n) || 0));

  function addPointsHistory(entry){
    const hist = store.get(LS.pointsHistory, []);
    hist.unshift(entry);
    store.set(LS.pointsHistory, hist.slice(0, 40));
  }

  function applyPointsDelta(delta, reason){
    const prev = getPoints();
    const next = Math.max(0, prev + delta);
    setPoints(next);
    addPointsHistory({
      at: nowISO(),
      delta,
      reason: reason || (delta >= 0 ? "Dodano punkty" : "Odjƒôto punkty")
    });
    renderPoints();
  }

  /* -------------------------
     Status / hours
     ------------------------- */
  const HOURS = {
    monThu: "12:00‚Äì22:00",
    fri: "12:00‚Äì23:00",
    sat: "12:00‚Äì23:00",
    sun: "12:00‚Äì22:00"
  };

  function isOpenNow(){
    // prosta logika statusu (mo≈ºesz podmieniƒá realnymi godzinami)
    // Dla UI: tylko ‚Äúotwarte/zamkniƒôte‚Äù na podstawie sta≈Çych godzin.
    const d = new Date();
    const day = d.getDay(); // 0 sun ... 6 sat
    const min = d.getHours()*60 + d.getMinutes();

    const parseRange = (range) => {
      const [a,b] = range.split("‚Äì");
      const toMin = (t) => {
        const [hh,mm] = t.split(":").map(Number);
        return hh*60 + mm;
      };
      return [toMin(a), toMin(b)];
    };

    let range = HOURS.sun;
    if (day >= 1 && day <= 4) range = HOURS.monThu;
    else if (day === 5) range = HOURS.fri;
    else if (day === 6) range = HOURS.sat;

    const [start,end] = parseRange(range);
    return min >= start && min <= end;
  }

  function renderHours(expanded){
    $("#h1").textContent = HOURS.monThu;
    $("#h2").textContent = HOURS.fri;
    $("#h3").textContent = HOURS.sat;
    $("#h4").textContent = HOURS.sun;
    $("#hoursGrid").classList.toggle("hide", !expanded);
  }

  function renderStatus(){
    const open = isOpenNow();
    const badge = $("#statusBadge");
    const txt = $("#statusText");
    const sub = $("#statusSub");

    if (!badge || !txt || !sub) return;

    badge.classList.remove("warn","bad");
    const dot = badge.querySelector(".b-dot");

    if (open){
      txt.textContent = "Otwarte";
      sub.textContent = "Wpadnij do nas ‚Äî dzia≈Çamy!";
      if (dot) dot.style.background = "var(--good)";
    } else {
      txt.textContent = "Zamkniƒôte";
      sub.textContent = "Aktualnie nieczynne ‚Äî sprawd≈∫ godziny.";
      badge.classList.add("warn");
      if (dot) dot.style.background = "var(--warn)";
    }
  }

  /* -------------------------
     Tabs / pages
     ------------------------- */
  function showPage(tab){
    const map = {
      points: "#pagePoints",
      rewards: "#pageRewards",
      order: "#pageOrder",
      reservations: "#pageReservations",
      account: "#pageAccount"
    };
    $$(".page").forEach(p => p.classList.remove("active"));
    $$(".nav-btn").forEach(b => b.classList.remove("active"));

    const pageSel = map[tab] || "#pagePoints";
    const page = $(pageSel);
    if (page) page.classList.add("active");

    const btn = $(`.nav-btn[data-tab="${tab}"]`);
    if (btn) btn.classList.add("active");

    // kart-fab tylko na Zam√≥w
    $("#cartFab").style.display = (tab === "order" && getCartCount() > 0) ? "block" : "none";
  }

  /* -------------------------
     Menu normalization
     ------------------------- */
  const MAIN_CATS = [
    { id: "kawa-herbata", label: "Kawa" },
    { id: "napoje-soki", label: "Napoje" },
    { id: "shake", label: "Shakes" },
    { id: "deser", label: "Desery" },
    { id: "texmex", label: "Tex Mex" },
    { id: "kanapki", label: "Kanapki" },
    { id: "burger", label: "Burgery" },
    { id: "sniadania", label: "≈öniadania" }
  ];

  function menuItemsByMainCategory(catId){
    return MENU_CATALOG.items.filter(it => it.category === catId);
  }

  function itemBaseId(it, idx){
    // stabilne id (tytu≈Ç+cat+idx)
    return `${it.category}::${idx}::${String(it.title).toLowerCase().replace(/\s+/g,"-")}`;
  }

  function itemDisplayPrice(it){
    if (Array.isArray(it.variants) && it.variants.length){
      const prices = it.variants.map(v => v.price).filter(n => Number.isFinite(Number(n)));
      if (prices.length){
        const min = Math.min(...prices);
        const max = Math.max(...prices);
        return min === max ? `${fmtPLN(min)} PLN` : `${fmtPLN(min)}‚Äì${fmtPLN(max)} PLN`;
      }
    }
    // price mo≈ºe byƒá string typu "12/17" albo "+12"
    if (typeof it.price === "string") return `${it.price} PLN`;
    return `${fmtPLN(it.price)} PLN`;
  }

  /* -------------------------
     Cart
     ------------------------- */
  const getCart = () => store.get(LS.cart, []);
  const setCart = (c) => store.set(LS.cart, c);

  function getCartCount(){
    return getCart().reduce((a,it) => a + (it.qty || 0), 0);
  }
  function getCartTotal(){
    return getCart().reduce((a,it) => a + (Number(it.unitPrice)||0) * (it.qty||0), 0);
  }

  function addToCart(product, variant){
    // product: {id,title,desc,tag,categoryLabel}
    // variant: {label, price, size} | null
    const vLabel = variant?.label ? String(variant.label) : null;
    const vSize = variant?.size ? String(variant.size) : null;
    const unitPrice = Number(variant?.price ?? product.priceNumber ?? product.price ?? 0);

    const key = `${product.id}::${vLabel||""}::${vSize||""}::${unitPrice}`;
    const cart = getCart();
    const found = cart.find(x => x.key === key);
    if (found){
      found.qty = (found.qty || 0) + 1;
    } else {
      cart.push({
        key,
        productId: product.id,
        title: product.title,
        desc: product.desc || "",
        category: product.mainCategory || "",
        variantLabel: vLabel,
        variantSize: vSize,
        unitPrice,
        qty: 1
      });
    }
    setCart(cart);
    toast.show("Dodano do koszyka", product.title + (vLabel ? ` ‚Ä¢ ${vLabel}` : ""));
    renderCartFab();
    renderCartModal();
  }

  function decCartItem(key){
    const cart = getCart();
    const it = cart.find(x => x.key === key);
    if (!it) return;
    it.qty = (it.qty || 0) - 1;
    const next = cart.filter(x => (x.qty || 0) > 0);
    setCart(next);
    renderCartFab();
    renderCartModal();
  }

  function incCartItem(key){
    const cart = getCart();
    const it = cart.find(x => x.key === key);
    if (!it) return;
    it.qty = (it.qty || 0) + 1;
    setCart(cart);
    renderCartFab();
    renderCartModal();
  }

  function removeCartItem(key){
    const cart = getCart().filter(x => x.key !== key);
    setCart(cart);
    renderCartFab();
    renderCartModal();
  }

  function clearCart(){
    setCart([]);
    renderCartFab();
    renderCartModal();
  }

  /* -------------------------
     Orders
     ------------------------- */
  const getOrders = () => store.get(LS.orders, []);
  const setOrders = (o) => store.set(LS.orders, o);

  function pickupLeadMinutes(){
    const d = new Date();
    const day = d.getDay(); // 0 sun, 6 sat
    // Mon-Thu: 30, Fri-Sun: 45
    if (day >= 1 && day <= 4) return 30;
    return 45;
  }

  function setDefaultPickupTime(){
    const el = $("#checkoutTime");
    if (!el) return;
    const d = new Date();
    d.setMinutes(d.getMinutes() + pickupLeadMinutes());
    const hh = String(d.getHours()).padStart(2,"0");
    const mm = String(d.getMinutes()).padStart(2,"0");
    el.value = `${hh}:${mm}`;
  }

  async function placeOrder(){
    if (!isLoggedIn()){
      toast.show("Wymagane logowanie", "Zaloguj siƒô, aby z≈Ço≈ºyƒá zam√≥wienie.");
      showPage("account");
      return;
    }

    const cart = getCart();
    if (!cart.length){
      toast.show("Koszyk pusty", "Dodaj produkty do koszyka.");
      return;
    }

    const name = ($("#checkoutName").value || "").trim();
    const phone = ($("#checkoutPhone").value || "").trim();
    const location = ($("#checkoutLocation").value || "S≈Çupsk").trim();
    const time = ($("#checkoutTime").value || "").trim();
    const notes = ($("#checkoutNotes").value || "").trim();

    if (!name || !phone){
      toast.show("Brak danych", "Podaj imiƒô i telefon.");
      return;
    }
    if (!time){
      toast.show("Brak godziny", "Wybierz godzinƒô odbioru.");
      return;
    }
    if (location === "Rowy"){
      toast.show("Rowy wy≈ÇƒÖczone", "Odbi√≥r w Rowach jest chwilowo wy≈ÇƒÖczony.");
      return;
    }

    const u = getUser();
    const payload = {
      createdAt: nowISO(),
      email: u.email,
      milkId: getMilkIdForUser(),
      customer: { name, phone },
      pickup: { location, time, notes },
      items: cart.map(it => ({
        title: it.title,
        variant: it.variantLabel || null,
        unitPrice: it.unitPrice,
        qty: it.qty
      })),
      total: getCartTotal()
    };

    // pr√≥bujemy serwer
    let ok = false;
    let serverMsg = "";
    try{
      const r = await fetch("/api/orders", {
        method: "POST",
        headers: { "Content-Type":"application/json" },
        body: JSON.stringify(payload)
      });
      if (r.ok){
        ok = true;
        try{
          const js = await r.json();
          if (js?.message) serverMsg = js.message;
          if (js?.orderId) payload.orderId = js.orderId;
        }catch{}
      }
    }catch{}

    // lokalny zapis (zawsze)
    const orders = getOrders();
    orders.unshift({ ...payload, status: ok ? "Wys≈Çane" : "Zapisane lokalnie", id: payload.orderId || ("local_" + Date.now()) });
    setOrders(orders.slice(0, 40));

    clearCart();
    renderOrders();

    toast.show("Zam√≥wienie przyjƒôte", ok ? (serverMsg || "Wys≈Çano na serwer.") : "Brak po≈ÇƒÖczenia ‚Äî zapis lokalny.");
    closeModal("#cartModal");
  }

  /* -------------------------
     Reservations
     ------------------------- */
  const getReservations = () => store.get(LS.reservations, []);
  const setReservations = (r) => store.set(LS.reservations, r);

  async function sendReservation(){
    if (!isLoggedIn()){
      toast.show("Wymagane logowanie", "Zaloguj siƒô, aby wys≈Çaƒá rezerwacjƒô.");
      showPage("account");
      return;
    }

    const name = ($("#resName").value || "").trim();
    const phone = ($("#resPhone").value || "").trim();
    const date = ($("#resDate").value || "").trim();
    const time = ($("#resTime").value || "").trim();
    const people = ($("#resPeople").value || "").trim();
    const notes = ($("#resNotes").value || "").trim();

    if (!name || !phone || !date || !time || !people){
      toast.show("Uzupe≈Çnij dane", "Imiƒô, telefon, data, godzina i liczba os√≥b sƒÖ wymagane.");
      return;
    }

    const u = getUser();
    const payload = {
      createdAt: nowISO(),
      email: u.email,
      milkId: getMilkIdForUser(),
      name, phone, date, time, people: Number(people) || people, notes
    };

    let ok = false;
    try{
      const r = await fetch("/api/rezerwacje", {
        method: "POST",
        headers: { "Content-Type":"application/json" },
        body: JSON.stringify(payload)
      });
      ok = r.ok;
      if (ok){
        try{
          const js = await r.json();
          if (js?.id) payload.id = js.id;
        }catch{}
      }
    }catch{}

    const list = getReservations();
    list.unshift({ ...payload, status: ok ? "Wys≈Çano" : "Lokalnie", id: payload.id || ("local_" + Date.now()) });
    setReservations(list.slice(0, 40));

    renderReservations();
    toast.show("Rezerwacja zapisana", ok ? "Wys≈Çano na serwer." : "Brak po≈ÇƒÖczenia ‚Äî zapis lokalny.");
    $("#resHint").textContent = ok ? "Wys≈Çano rezerwacjƒô na serwer." : "Zapisano lokalnie (spr√≥buj p√≥≈∫niej ponownie).";
  }

  function deleteReservation(id){
    const list = getReservations().filter(x => x.id !== id);
    setReservations(list);
    renderReservations();
    toast.show("Usuniƒôto", "Rezerwacja usuniƒôta lokalnie.");
  }

  /* -------------------------
     Rewards
     ------------------------- */
  const getRedeemed = () => store.get(LS.redeemed, []);
  const setRedeemed = (r) => store.set(LS.redeemed, r);

  async function redeemReward(rewardId){
    const rw = REWARDS.find(r => r.id === rewardId);
    if (!rw) return;

    if (!isLoggedIn()){
      toast.show("Wymagane logowanie", "Zaloguj siƒô, aby realizowaƒá nagrody.");
      showPage("account");
      return;
    }

    const pts = getPoints();
    if (pts < rw.points){
      toast.show("Za ma≈Ço punkt√≥w", `Potrzebujesz ${rw.points} pkt.`);
      return;
    }

    // pr√≥bujemy endpoint (je≈õli istnieje), ale mamy fallback lokalny
    let ok = false;
    try{
      const r = await fetch("/api/rewards/redeem", {
        method: "POST",
        headers: { "Content-Type":"application/json" },
        body: JSON.stringify({
          rewardId: rw.id,
          email: getUser().email,
          milkId: getMilkIdForUser(),
          at: nowISO()
        })
      });
      ok = r.ok;
    }catch{}

    applyPointsDelta(-rw.points, `Realizacja nagrody: ${rw.title}`);

    const redeemed = getRedeemed();
    redeemed.unshift({
      id: "redeem_" + Date.now(),
      rewardId: rw.id,
      title: rw.title,
      points: rw.points,
      at: nowISO(),
      status: ok ? "Zarejestrowano" : "Lokalnie"
    });
    setRedeemed(redeemed.slice(0, 30));

    toast.show("Zrealizowano nagrodƒô", ok ? "Zapisano na serwerze." : "Zapis lokalny (offline).");
    renderRewards();
  }

  /* -------------------------
     Rendering
     ------------------------- */
  function renderPoints(){
    const pts = getPoints();
    const p1 = $("#pointsValue");
    const p2 = $("#pointsBig");
    if (p1) p1.textContent = String(pts);
    if (p2) p2.textContent = String(pts);

    // do najbli≈ºszej nagrody
    const next = [...REWARDS].sort((a,b)=>a.points-b.points).find(r => r.points > pts);
    const toNext = $("#toNext");
    if (toNext){
      if (!next) toNext.textContent = "Masz na wszystkie üéâ";
      else toNext.textContent = `${next.points - pts} pkt`;
    }

    // historia
    const histEl = $("#pointsHistory");
    if (histEl){
      const hist = store.get(LS.pointsHistory, []);
      if (!hist.length){
        histEl.innerHTML = `<div class="mini">Brak historii.</div>`;
      } else {
        histEl.innerHTML = hist.map(h => {
          const d = new Date(h.at);
          const delta = Number(h.delta)||0;
          const sign = delta >= 0 ? "+" : "";
          return `
            <div class="item">
              <div class="meta">
                <b>${h.reason || "Operacja"}</b>
                <span>${d.toLocaleString("pl-PL")}</span>
              </div>
              <div class="right">
                <div class="price">${sign}${delta} pkt</div>
              </div>
            </div>
          `;
        }).join("");
      }
    }
  }

  function renderRewards(){
    const el = $("#rewardsList");
    if (!el) return;

    const pts = getPoints();
    el.innerHTML = REWARDS.map(r => {
      const disabled = pts < r.points;
      return `
        <div class="item">
          <div class="meta">
            <b>${r.title}</b>
            <span>${r.desc}</span>
          </div>
          <div class="right">
            <div class="price">${r.points} pkt</div>
            <button class="btn small ${disabled ? "ghost" : "primary"}" data-reward="${r.id}" ${disabled ? "disabled" : ""}>
              ${disabled ? "Brak pkt" : "Zrealizuj"}
            </button>
          </div>
        </div>
      `;
    }).join("");

    // bind
    el.querySelectorAll("button[data-reward]").forEach(btn => {
      btn.addEventListener("click", () => redeemReward(btn.getAttribute("data-reward")));
    });
  }

  function renderOrderCategories(activeCat){
    const wrap = $("#orderCategories");
    if (!wrap) return;

    const current = activeCat || store.get("milk_active_cat", MAIN_CATS[0].id);
    store.set("milk_active_cat", current);

    wrap.innerHTML = MAIN_CATS.map(c => `
      <button class="chip ${c.id === current ? "active" : ""}" data-cat="${c.id}">
        ${c.label}
      </button>
    `).join("");

    wrap.querySelectorAll(".chip").forEach(ch => {
      ch.addEventListener("click", () => {
        const id = ch.getAttribute("data-cat");
        renderOrderCategories(id);
        renderOrderProducts(id);
      });
    });
  }

  function renderOrderProducts(catId){
    const list = $("#orderProducts");
    if (!list) return;

    const items = menuItemsByMainCategory(catId);
    if (!items.length){
      list.innerHTML = `<div class="mini">Brak produkt√≥w w tej kategorii.</div>`;
      return;
    }

    list.innerHTML = items.map((it, idx) => {
      const pid = itemBaseId(it, idx);
      const hasVar = Array.isArray(it.variants) && it.variants.length;
      const priceTxt = itemDisplayPrice(it);
      const desc = (it.desc || "").trim();
      const tag = (it.tag || "").trim();

      if (!hasVar){
        return `
          <div class="item">
            <div class="meta">
              <b>${it.title}</b>
              <span>${[tag, desc].filter(Boolean).join(" ‚Ä¢ ")}</span>
            </div>
            <div class="right">
              <div class="price">${priceTxt}</div>
              <button class="btn small primary" data-add="${pid}">Dodaj</button>
            </div>
          </div>
        `;
      }

      const options = it.variants.map((v, i) => {
        const lbl = (v.label || v.size || `wariant ${i+1}`).toString();
        return `<option value="${i}">${lbl} ‚Äî ${fmtPLN(v.price)} PLN</option>`;
      }).join("");

      return `
        <div class="item">
          <div class="meta">
            <b>${it.title}</b>
            <span>${[tag, desc].filter(Boolean).join(" ‚Ä¢ ")}</span>
            <div style="margin-top:8px">
              <select class="input" style="padding:10px 12px;border-radius:14px" data-variant-select="${pid}">
                ${options}
              </select>
            </div>
          </div>
          <div class="right">
            <div class="price">${priceTxt}</div>
            <button class="btn small primary" data-add="${pid}">Dodaj</button>
          </div>
        </div>
      `;
    }).join("");

    // bind add buttons
    list.querySelectorAll("button[data-add]").forEach(btn => {
      btn.addEventListener("click", () => {
        const pid = btn.getAttribute("data-add");
        const idx = parseInt(pid.split("::")[1], 10);
        const it = items[idx];
        const hasVar = Array.isArray(it.variants) && it.variants.length;

        const product = {
          id: pid,
          title: it.title,
          desc: it.desc || "",
          tag: it.tag || "",
          mainCategory: catId,
          priceNumber: (typeof it.price === "number") ? it.price : null
        };

        if (!hasVar){
          addToCart(product, null);
          return;
        }

        const sel = list.querySelector(`select[data-variant-select="${pid}"]`);
        const vi = sel ? Number(sel.value) : 0;
        const v = it.variants[vi] || it.variants[0];
        addToCart(product, v);
      });
    });

    renderCartFab();
  }

  function renderCartFab(){
    const fab = $("#cartFab");
    const c = getCartCount();
    const t = getCartTotal();
    $("#fabCount").textContent = String(c);
    $("#fabTotal").textContent = fmtPLN(t);
    $("#cartTotal").textContent = fmtPLN(t);
    if (fab) fab.style.display = (showingTab() === "order" && c > 0) ? "block" : "none";
  }

  function renderCartModal(){
    const list = $("#cartList");
    if (!list) return;

    const cart = getCart();
    if (!cart.length){
      list.innerHTML = `<div class="mini">Koszyk jest pusty.</div>`;
      $("#cartTotal").textContent = "0";
      renderCartFab();
      return;
    }

    list.innerHTML = cart.map(it => {
      const vv = it.variantLabel ? ` ‚Ä¢ ${it.variantLabel}` : "";
      return `
        <div class="item">
          <div class="meta">
            <b>${it.title}${vv}</b>
            <span>${it.desc || ""}</span>
          </div>
          <div class="right">
            <div class="price">${fmtPLN(it.unitPrice)} PLN</div>
            <div style="display:flex;gap:8px;align-items:center">
              <button class="btn small ghost" data-dec="${it.key}">‚àí</button>
              <div style="min-width:28px;text-align:center;font-weight:900">${it.qty}</div>
              <button class="btn small ghost" data-inc="${it.key}">+</button>
            </div>
            <button class="btn small ghost" data-rm="${it.key}">Usu≈Ñ</button>
          </div>
        </div>
      `;
    }).join("");

    list.querySelectorAll("button[data-dec]").forEach(b => b.addEventListener("click", () => decCartItem(b.getAttribute("data-dec"))));
    list.querySelectorAll("button[data-inc]").forEach(b => b.addEventListener("click", () => incCartItem(b.getAttribute("data-inc"))));
    list.querySelectorAll("button[data-rm]").forEach(b => b.addEventListener("click", () => removeCartItem(b.getAttribute("data-rm"))));

    const total = getCartTotal();
    $("#cartTotal").textContent = fmtPLN(total);

    // hint o regule odbioru
    const lead = pickupLeadMinutes();
    $("#pickupRuleHint").textContent = `Minimalny czas przygotowania: ${lead} min (${lead === 30 ? "Pon‚ÄìCzw" : "PiƒÖ‚ÄìNie"}).`;

    renderCartFab();
  }

  function renderOrders(){
    const el = $("#ordersList");
    if (!el) return;

    const orders = getOrders();
    if (!orders.length){
      el.innerHTML = `<div class="mini">Brak zam√≥wie≈Ñ.</div>`;
      return;
    }

    el.innerHTML = orders.map(o => {
      const d = new Date(o.createdAt);
      const total = fmtPLN(o.total || 0);
      const items = (o.items || []).slice(0,3).map(i => `${i.title}${i.variant ? ` (${i.variant})` : ""} √ó${i.qty}`).join(", ");
      return `
        <div class="item">
          <div class="meta">
            <b>${o.status || "Zam√≥wienie"}</b>
            <span>${d.toLocaleString("pl-PL")} ‚Ä¢ ${o.pickup?.location || "S≈Çupsk"} ‚Ä¢ odbi√≥r ${o.pickup?.time || "‚Äî"}</span>
            <span>${items}${(o.items||[]).length>3 ? "‚Ä¶" : ""}</span>
          </div>
          <div class="right">
            <div class="price">${total} PLN</div>
          </div>
        </div>
      `;
    }).join("");
  }

  function renderReservations(){
    const el = $("#resList");
    if (!el) return;

    const list = getReservations();
    if (!list.length){
      el.innerHTML = `<div class="mini">Brak rezerwacji.</div>`;
      return;
    }

    el.innerHTML = list.map(r => {
      const d = new Date(r.createdAt);
      return `
        <div class="item">
          <div class="meta">
            <b>${r.status || "Rezerwacja"} ‚Ä¢ ${r.date} ${r.time}</b>
            <span>${r.people} os. ‚Ä¢ ${r.name} ‚Ä¢ ${r.phone}</span>
            <span>${r.notes ? r.notes : ""}</span>
          </div>
          <div class="right">
            <div class="price">${d.toLocaleDateString("pl-PL")}</div>
            <button class="btn small ghost" data-delres="${r.id}">Usu≈Ñ</button>
          </div>
        </div>
      `;
    }).join("");

    el.querySelectorAll("button[data-delres]").forEach(b => {
      b.addEventListener("click", () => deleteReservation(b.getAttribute("data-delres")));
    });
  }

  function renderAuthUI(){
    const u = getUser();
    const logged = !!u?.email;

    $("#authSub").textContent = logged ? `Zalogowano jako: ${u.email}` : "Zaloguj siƒô, aby korzystaƒá z pe≈Çnych funkcji";
    $("#logoutBtn").disabled = !logged;

    const hint = $("#authHint");
    if (hint){
      hint.textContent = logged
        ? `Milk ID: ${getMilkIdForUser()}`
        : "Logowanie jest uproszczone (mock).";
    }

    // top subtitle
    $("#topSubtitle").textContent = logged ? `Zalogowano ‚Ä¢ ${u.email}` : "Lojalno≈õƒá ‚Ä¢ Nagrody ‚Ä¢ Zam√≥wienia";
  }

  /* -------------------------
     Modals
     ------------------------- */
  function openModal(sel){
    const m = $(sel);
    if (!m) return;
    m.classList.add("show");
    m.setAttribute("aria-hidden", "false");
  }
  function closeModal(sel){
    const m = $(sel);
    if (!m) return;
    m.classList.remove("show");
    m.setAttribute("aria-hidden", "true");
  }

  /* -------------------------
     Milk ID modal
     ------------------------- */
  function openMilkId(){
    if (!isLoggedIn()){
      toast.show("Wymagane logowanie", "Zaloguj siƒô, aby zobaczyƒá Milk ID.");
      showPage("account");
      return;
    }
    const code = getMilkIdForUser();
    $("#milkIdInput").value = code || "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢";
    $("#milkIdHint").textContent = `Kod jest przypisany do e-maila: ${getUser().email}`;
    openModal("#milkIdModal");
  }

  /* -------------------------
     Install overlay
     ------------------------- */
  let deferredPrompt = null;

  function isStandalone(){
    return window.matchMedia("(display-mode: standalone)").matches || window.navigator.standalone === true;
  }

  function maybeShowInstall(){
    if (isStandalone()) return;
    const shown = store.get("milk_install_dismissed", false);
    if (!shown) openInstall();
  }

  function openInstall(){
    $("#pwaState").textContent = isStandalone() ? "Zainstalowana" : "PrzeglƒÖdarka";
    openModal("#installOverlay"); // overlay ma klasƒô .install, ale modal API dzia≈Ça tak samo (ma .show)
    $("#installOverlay").classList.add("show");
  }

  function closeInstall(dismiss){
    $("#installOverlay").classList.remove("show");
    if (dismiss) store.set("milk_install_dismissed", true);
  }

  async function triggerInstall(){
    if (!deferredPrompt){
      toast.show("Instalacja", "Na iOS: Udostƒôpnij ‚Üí Dodaj do ekranu. Na Android: menu ‚Üí Zainstaluj.");
      return;
    }
    deferredPrompt.prompt();
    try { await deferredPrompt.userChoice; } catch {}
    deferredPrompt = null;
  }

  /* -------------------------
     Settings subpages
     ------------------------- */
  function showSub(id){
    ["#subPersonal","#subLang","#subAbout","#subHelp"].forEach(s => $(s).classList.add("hide"));
    $(id).classList.remove("hide");
    window.scrollTo({ top: 0, behavior: "smooth" });
  }
  function hideSubs(){
    ["#subPersonal","#subLang","#subAbout","#subHelp"].forEach(s => $(s).classList.add("hide"));
  }

  /* -------------------------
     Which tab is active?
     ------------------------- */
  function showingTab(){
    const btn = $(".nav-btn.active");
    return btn ? btn.getAttribute("data-tab") : "points";
  }

  /* -------------------------
     Service worker
     ------------------------- */
  async function registerSW(){
    if (!("serviceWorker" in navigator)) return;
    try{
      await navigator.serviceWorker.register("sw.js");
    }catch{}
  }

  /* -------------------------
     Bind UI events
     ------------------------- */
  function bind(){
    // bottom nav
    $$(".nav-btn").forEach(b => {
      b.addEventListener("click", () => {
        hideSubs();
        showPage(b.getAttribute("data-tab"));
        renderCartFab();
      });
    });

    // quick actions
    $("#qaMilkId").addEventListener("click", openMilkId);
    $("#qaOrder").addEventListener("click", () => showPage("order"));
    $("#qaRewards").addEventListener("click", () => showPage("rewards"));
    $("#qaReservation").addEventListener("click", () => showPage("reservations"));

    // points page
    $("#openMilkId").addEventListener("click", openMilkId);

    // eatmi
    $("#eatmiBtn").addEventListener("click", () => {
      window.open("https://eatmi.pl", "_blank");
    });

    // status card toggle hours
    let expanded = false;
    renderHours(expanded);
    $("#statusCard").addEventListener("click", () => {
      expanded = !expanded;
      renderHours(expanded);
    });

    // Milk ID modal
    $("#milkIdClose").addEventListener("click", () => closeModal("#milkIdModal"));
    $("#milkIdCopy").addEventListener("click", async () => {
      const v = $("#milkIdInput").value;
      try{ await navigator.clipboard.writeText(v); }catch{}
      toast.show("Skopiowano", "Milk ID skopiowane do schowka.");
    });

    // cart modal open/close
    $("#openCartTop").addEventListener("click", () => { renderCartModal(); openModal("#cartModal"); setDefaultPickupTime(); });
    $("#openCartFab").addEventListener("click", () => { renderCartModal(); openModal("#cartModal"); setDefaultPickupTime(); });
    $("#cartClose").addEventListener("click", () => closeModal("#cartModal"));
    $("#placeOrderBtn").addEventListener("click", placeOrder);

    // install overlay
    $("#installClose").addEventListener("click", () => closeInstall(true));
    $("#installLater").addEventListener("click", () => closeInstall(true));
    $("#installBtn").addEventListener("click", triggerInstall);

    // account login
    $("#loginGoogle").addEventListener("click", () => {
      // mock google: je≈õli wpisany email, bierzemy go; jak nie, generujemy
      const email = ($("#emailInput").value || "").trim() || `user${Math.floor(Math.random()*9999)}@gmail.com`;
      setUser({ email, provider: "google", at: nowISO() });
      toast.show("Zalogowano", email);
      renderAuthUI();
    });

    $("#loginEmail").addEventListener("click", () => {
      $("#emailInput").focus();
      toast.show("Logowanie e-mail", "Wpisz e-mail i kliknij ‚ÄúZaloguj‚Äù.");
    });

    $("#loginSubmit").addEventListener("click", async () => {
      const email = ($("#emailInput").value || "").trim();
      const pass = ($("#passInput").value || "").trim();
      if (!email){
        toast.show("Brak e-maila", "Wpisz e-mail.");
        return;
      }

      // pr√≥bujemy /api/auth/login (je≈õli istnieje)
      let ok = false;
      try{
        const r = await fetch("/api/auth/login", {
          method: "POST",
          headers: { "Content-Type":"application/json" },
          body: JSON.stringify({ email, password: pass })
        });
        ok = r.ok;
      }catch{}

      setUser({ email, provider: "email", at: nowISO(), server: ok });
      toast.show("Zalogowano", ok ? "Zweryfikowano na serwerze." : "Tryb offline (mock).");
      renderAuthUI();
    });

    $("#logoutBtn").addEventListener("click", () => {
      store.del(LS.user);
      toast.show("Wylogowano", "Konto zosta≈Ço wylogowane.");
      renderAuthUI();
    });

    // settings subpages
    $("#settingsPersonal").addEventListener("click", () => {
      showSub("#subPersonal");
      const prof = store.get(LS.profile, {});
      $("#profName").value = prof.name || "";
      $("#profPhone").value = prof.phone || "";
    });
    $("#settingsLang").addEventListener("click", () => showSub("#subLang"));
    $("#settingsAbout").addEventListener("click", () => showSub("#subAbout"));
    $("#settingsHelp").addEventListener("click", () => showSub("#subHelp"));

    $("#subBack1").addEventListener("click", hideSubs);
    $("#subBack2").addEventListener("click", hideSubs);
    $("#subBack3").addEventListener("click", hideSubs);
    $("#subBack4").addEventListener("click", hideSubs);

    $("#profSave").addEventListener("click", () => {
      const name = ($("#profName").value || "").trim();
      const phone = ($("#profPhone").value || "").trim();
      store.set(LS.profile, { name, phone, at: nowISO() });
      toast.show("Zapisano", "Dane profilu zapisane lokalnie.");
      hideSubs();
    });

    $("#langPL").addEventListener("click", () => {
      store.set(LS.lang, "pl");
      toast.show("Jƒôzyk", "Ustawiono: Polski");
      hideSubs();
    });
    $("#langEN").addEventListener("click", () => {
      store.set(LS.lang, "en");
      toast.show("Language", "Set: English");
      hideSubs();
    });

    // reservations
    $("#resSend").addEventListener("click", sendReservation);

    // toast close (ju≈º w toast module)
  }

  /* -------------------------
     Init
     ------------------------- */
  function init(){
    initPointsIfMissing();

    // wersja / pwa state
    $("#appVer").textContent = "1.0";
    $("#pwaState").textContent = isStandalone() ? "Zainstalowana" : "PrzeglƒÖdarka";

    // status/hours
    renderStatus();
    setInterval(renderStatus, 60_000);

    // render main
    renderAuthUI();
    renderPoints();
    renderRewards();
    renderOrders();
    renderReservations();

    // order tab
    const activeCat = store.get("milk_active_cat", MAIN_CATS[0].id);
    renderOrderCategories(activeCat);
    renderOrderProducts(activeCat);

    // cart
    renderCartFab();
    renderCartModal();

    // subpages hidden
    hideSubs();

    // default tab
    showPage("points");

    // pickup hint initial
    $("#pickupRuleHint").textContent = `Minimalny czas przygotowania: ${pickupLeadMinutes()} min.`;

    // install
    window.addEventListener("beforeinstallprompt", (e) => {
      e.preventDefault();
      deferredPrompt = e;
      // nie pokazujemy na si≈Çƒô, ale przycisk bƒôdzie dzia≈Ça≈Ç
    });

    // overlay w przeglƒÖdarce (bez przesady ‚Äî mo≈ºna zdjƒÖƒá je≈õli nie chcesz)
    maybeShowInstall();

    // sw
    registerSW();
  }

  // fix: install overlay korzysta z osobnych klas
  function openModalInstallCompat(){
    $("#installOverlay").classList.add("show");
  }

  // ‚Äúmodal‚Äù helpers u≈ºywajƒÖ .modal, wiƒôc dla install robimy oddzielnie (ale i tak operujemy bezpo≈õrednio)
  function openModal(sel){
    const m = $(sel);
    if (!m) return;
    m.classList.add("show");
    m.setAttribute("aria-hidden", "false");
  }

  document.addEventListener("DOMContentLoaded", () => {
    bind();
    init();

    // Drobna poprawka: install overlay (to nie jest .modal)
    // (zostawiamy, bo w init mo≈ºe siƒô pojawiƒá)
    if ($("#installOverlay") && $("#installOverlay").classList.contains("show")) {
      openModalInstallCompat();
    }
  });

})();
</script>

</script>

</body>
</html>
